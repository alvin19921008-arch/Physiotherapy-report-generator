<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physiotherapy Report Generator - Lite App v1.2 Unique IDs</title>
    <meta name="description" content="Lite version of physiotherapy medical report generator for data collection and export to full app.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2563eb;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #64748b;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tab {
            padding: 12px 16px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            text-decoration: none;
        }

        .nav-tab:hover {
            background: #e2e8f0;
            color: #475569;
        }

        .nav-tab.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            color: #1e40af;
            font-size: 1.5rem;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: table;
            width: 100%;
            margin-bottom: 20px;
        }

        .form-col {
            display: table-cell;
            width: 50%;
            padding-right: 10px;
            vertical-align: top;
        }

        .form-col:last-child {
            padding-right: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .helper-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-success {
            background-color: #059669;
            color: white;
        }

        .btn-success:hover {
            background-color: #047857;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .clinical-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .clinical-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .clinical-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .clinical-content {
            display: none;
        }

        .clinical-content.active {
            display: block;
        }

        .checkbox-group {
            margin-bottom: 15px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .clinical-section {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f8fafc;
        }

        .section-header {
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            font-size: 1.1rem;
        }

        .auto-fill-section {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .auto-fill-text {
            font-size: 14px;
            color: #1e40af;
            margin-bottom: 10px;
        }

        .auto-fill-controls {
            display: table;
            width: 100%;
        }

        .auto-fill-col {
            display: table-cell;
            padding-right: 10px;
            vertical-align: middle;
        }

        .auto-fill-col:last-child {
            padding-right: 0;
        }

        .grid-3 {
            display: table;
            width: 100%;
            margin-bottom: 10px;
        }

        .grid-3-col {
            display: table-cell;
            width: 33.33%;
            padding-right: 10px;
            vertical-align: middle;
        }

        .grid-3-col:last-child {
            padding-right: 0;
        }

        .grid-2 {
            display: table;
            width: 100%;
            margin-bottom: 10px;
        }

        .grid-2-col {
            display: table-cell;
            width: 50%;
            padding-right: 10px;
            vertical-align: middle;
        }

        .grid-2-col:last-child {
            padding-right: 0;
        }

        .muscle-row {
            display: table;
            width: 100%;
            margin-bottom: 8px;
        }

        .muscle-label {
            display: table-cell;
            width: 120px;
            padding-right: 10px;
            vertical-align: middle;
            font-weight: 500;
        }

        .muscle-input {
            display: table-cell;
            vertical-align: middle;
        }

        .small-input {
            width: 100px;
        }

        .medium-input {
            width: 150px;
        }

        .wide-input {
            width: 300px;
        }

        .finger-toe-panel {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
        }

        .finger-toe-header {
            display: table;
            width: 100%;
            margin-bottom: 15px;
        }

        .finger-toe-name {
            display: table-cell;
            width: 70%;
            padding-right: 10px;
            vertical-align: middle;
        }

        .finger-toe-remove {
            display: table-cell;
            width: 30%;
            text-align: right;
            vertical-align: middle;
        }

        .joint-checkboxes {
            display: table;
            width: 100%;
            margin-bottom: 15px;
        }

        .joint-checkbox-col {
            display: table-cell;
            width: 50%;
            padding-right: 10px;
            vertical-align: top;
        }

        .joint-checkbox-col:last-child {
            padding-right: 0;
        }

        .joint-checkbox-item {
            margin-bottom: 8px;
        }

        .joint-ranges {
            margin-top: 15px;
        }

        .joint-range-row {
            display: table;
            width: 100%;
            margin-bottom: 8px;
        }

        .joint-range-label {
            display: table-cell;
            width: 200px;
            padding-right: 10px;
            vertical-align: middle;
            font-size: 14px;
        }

        .joint-range-input {
            display: table-cell;
            vertical-align: middle;
        }

        .export-section {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .export-output {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            word-break: break-all;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .form-row, .grid-2, .grid-3, .muscle-row, .auto-fill-controls, .finger-toe-header, .joint-checkboxes, .joint-range-row {
                display: block;
            }
            
            .form-col, .grid-2-col, .grid-3-col, .muscle-label, .muscle-input, .auto-fill-col, .finger-toe-name, .finger-toe-remove, .joint-checkbox-col, .joint-range-label, .joint-range-input {
                display: block;
                width: 100%;
                padding-right: 0;
                margin-bottom: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .clinical-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Physiotherapy Report Generator - Lite App v1.2</h1>
            <div class="subtitle">Unique Element IDs | React-like Data Isolation</div>
            <div style="margin-top: 15px;">
                <button type="button" class="btn btn-secondary" onclick="fillHandMockData()" style="background-color: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Fill Mock Data (Hand)</button>
            </div>
        </div>

        <div class="nav-tabs">
            <a href="#section1" class="nav-tab active" onclick="showSection(1); return false;">Section 1: Reference</a>
            <a href="#section2" class="nav-tab" onclick="showSection(2); return false;">Section 2: Patient Info</a>
            <a href="#section3" class="nav-tab" onclick="showSection(3); return false;">Section 3: Diagnosis</a>
            <a href="#section4" class="nav-tab" onclick="showSection(4); return false;">Section 4: Referral</a>
            <a href="#section5" class="nav-tab" onclick="showSection(5); return false;">Section 5: Duration</a>
            <a href="#section6" class="nav-tab" onclick="showSection(6); return false;">Section 6: Clinical</a>
            <a href="#section7" class="nav-tab" onclick="showSection(7); return false;">Section 7: Treatment</a>
            <a href="#section8" class="nav-tab" onclick="showSection(8); return false;">Section 8: Discharge</a>
            <a href="#section9" class="nav-tab" onclick="showSection(9); return false;">Section 9: Declaration</a>
        </div>

        <!-- Section 1: Reference Information -->
        <div id="section1" class="section active">
            <h2 class="section-title">Section 1: Medical Report Reference Information</h2>
            
            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">Our Reference</label>
                        <div>
                            (<input type="text" id="ourRefNumber" class="form-input" style="width: 100px; display: inline-block;">) in PHY/OA/<input type="text" id="ourRefSuffix" class="form-input" style="width: 100px; display: inline-block;">
                        </div>
                    </div>
                    <div class="form-col">
                        <label class="form-label">Your Reference</label>
                        <input type="text" id="yourRef" class="form-input">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Report Date</label>
                    <input type="date" id="reportDate" class="form-input">
                </div>
                <div class="form-col">
                    <label class="form-label">Your Reference Date</label>
                    <input type="date" id="yourRefDate" class="form-input">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Recipient</label>
                <input type="text" id="recipient" class="form-input">
            </div>
        </div>

        <!-- Section 2: Patient Information -->
        <div id="section2" class="section">
            <h2 class="section-title">Section 2: Patient Information</h2>

            <div class="form-group">
                <label class="form-label">Name of Patient:</label>
                <input type="text" id="patientName" class="form-input" placeholder="e.g., CHAN, T. M.">
                <div class="helper-text">e.g., CHAN Tai Man, input CHAN, T. M.</div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Sex</label>
                    <select id="patientSex" class="form-select">
                        <option value="">Select sex</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div class="form-col">
                    <label class="form-label">Age</label>
                    <input type="number" id="patientAge" class="form-input" placeholder="e.g., 45">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">HKID No.</label>
                    <input type="text" id="hkidNo" class="form-input" placeholder="e.g., A123456(7)">
                </div>
                <div class="form-col">
                    <label class="form-label">Physiotherapy OPD No.</label>
                    <input type="text" id="physiotherapyOpdNo" class="form-input" placeholder="e.g., PHY240001">
                </div>
            </div>
        </div>

        <!-- Section 3: Primary Diagnosis -->
        <div id="section3" class="section">
            <h2 class="section-title">Section 3: Primary Diagnosis</h2>

            <div class="form-group">
                <label class="form-label">Primary Diagnosis:</label>
                <textarea id="diagnosis" class="form-textarea" placeholder="Enter primary diagnosis"></textarea>
            </div>
        </div>

        <!-- Section 4: Source of Referral -->
        <div id="section4" class="section">
            <h2 class="section-title">Section 4: Source of Referral</h2>

            <div id="referralSources">
                <div class="referral-source">
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Department:</label>
                            <input type="text" class="form-input referral-department" placeholder="e.g., Department of Orthopedics and Traumatology">
                        </div>
                        <div class="form-col">
                            <label class="form-label">Hospital:</label>
                            <input type="text" class="form-input referral-hospital" placeholder="e.g., Tuen Mun Hospital">
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-secondary" onclick="addReferralSource()">Add Referral Source</button>
        </div>

        <!-- Section 5: Duration of Treatment -->
        <div id="section5" class="section">
            <h2 class="section-title">Section 5: Duration of Treatment</h2>
            
            <div class="form-group">
                <label class="form-label">Total Number of Sessions</label>
                <input type="number" id="totalSessions" class="form-input" placeholder="e.g., 12">
            </div>

            <h4>Treatment Details Table</h4>
            
            <div class="form-group">
                <label class="form-label">Date of Registration</label>
                <input type="date" id="registrationDate" class="form-input">
            </div>

            <h4>Treatment Period</h4>
            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Start Date</label>
                    <input type="date" id="treatmentStartDate" class="form-input">
                </div>
                <div class="form-col">
                    <label class="form-label">End Date</label>
                    <input type="date" id="treatmentEndDate" class="form-input">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Case Therapist(s)</label>
                <textarea id="caseTherapists" class="form-textarea" placeholder="Enter case therapist names"></textarea>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Report Written by</label>
                    <input type="text" id="reportWrittenBy" class="form-input" placeholder="Therapist name">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Attended Sessions</label>
                    <input type="number" id="attendedSessions" class="form-input" placeholder="e.g., 10">
                </div>
                <div class="form-col">
                    <label class="form-label">Defaulted Sessions</label>
                    <input type="number" id="defaultedSessions" class="form-input" placeholder="e.g., 2">
                </div>
            </div>
        </div>

        <!-- Section 6: Clinical Information -->
        <div id="section6" class="section">
            <h2 class="section-title">Section 6: Clinical Information</h2>
            
            <div class="clinical-tabs">
                <button class="clinical-tab active" onclick="showClinicalTab('initial')">Initial Findings</button>
                <button class="clinical-tab" onclick="showClinicalTab('interim')">Interim Findings</button>
                <button class="clinical-tab" onclick="showClinicalTab('final')">Final Findings</button>
            </div>

            <!-- Initial Clinical Findings -->
            <div id="initial-clinical" class="clinical-content active">
                <h3>Initial Clinical Findings</h3>
                
                <div class="form-group">
                    <label class="form-label">Date:</label>
                    <input type="date" id="initialDate" class="form-input">
                </div>

                <div class="clinical-section">
                    <div class="section-header">I. Patient's Complaints</div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Side:</label>
                            <select id="initialSide" class="form-select" onchange="updateInitialRegionFields()">
                                <option value="">Select Side</option>
                                <option value="Right">Right</option>
                                <option value="Left">Left</option>
                                <option value="Bilateral">Bilateral</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Pain Region:</label>
                            <select id="initialLocation" class="form-select" onchange="updateInitialRegionFields()">
                                <option value="">Select Region</option>
                                <option value="back">Back</option>
                                <option value="neck">Neck</option>
                                <option value="shoulder">Shoulder</option>
                                <option value="elbow">Elbow</option>
                                <option value="wrist">Wrist</option>
                                <option value="hand">Hand</option>
                                <option value="hip">Hip</option>
                                <option value="knee">Knee</option>
                                <option value="ankle">Ankle</option>
                                <option value="foot">Foot</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Pain Intensity (NPRS):</label>
                            <input type="number" id="initialPainIntensity" class="form-input" min="0" max="10" placeholder="0-10">
                        </div>
                        <div class="form-col">
                            <label class="form-label">Other Symptoms:</label>
                            <input type="text" id="initialOtherSymptoms" class="form-input" placeholder="e.g., tingling, numbness">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Other symptoms intensity:</label>
                        <input type="text" id="initialSymptomsIntensity" class="form-input" placeholder="e.g., 5 or 4-6">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Sitting/Reading:</label>
                        <div class="grid-3">
                            <div class="grid-3-col">
                                <select id="initialActivity1" class="form-select">
                                    <option value="">Select activity</option>
                                    <option value="reading">Reading</option>
                                    <option value="sitting">Sitting</option>
                                </select>
                            </div>
                            <div class="grid-3-col">
                                <input type="text" id="initialActivity1Duration" class="form-input" placeholder="e.g., 30">
                            </div>
                            <div class="grid-3-col">
                                <select id="initialActivity1Unit" class="form-select">
                                    <option value="minutes">Minutes</option>
                                    <option value="hours">Hours</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Walking/Standing:</label>
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="initialActivity2" class="form-select">
                                            <option value="">Select activity</option>
                                            <option value="walking">Walking</option>
                                            <option value="standing">Standing</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <input type="text" id="initialActivity2Duration" class="form-input" placeholder="e.g., 10">
                                    </div>
                                </div>
                            </div>
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="initialActivity2Unit" class="form-select">
                                            <option value="minutes">Minutes</option>
                                            <option value="hours">Hours</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <select id="initialActivity2Aid" class="form-select">
                                            <option value="">Select Aid</option>
                                            <option value="unaided">Unaided</option>
                                            <option value="stick">Stick</option>
                                            <option value="quadruped">Quadruped</option>
                                            <option value="frame">Frame</option>
                                            <option value="elbow crutches">Elbow Crutches</option>
                                            <option value="rollator">Rollator</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small btn-secondary" onclick="addInitialFunctionalActivity()">Add More Functional Activities</button>
                    <div id="initialAdditionalActivities"></div>

                    <div class="form-group">
                        <label class="form-label">Other Functional Activities:</label>
                        <textarea id="initialOtherFunctionalActivities" class="form-textarea" placeholder="Describe other functional activities"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Overall Subjective Improvement (NGRCS):</label>
                        <select id="initialOverallImprovement" class="form-select">
                            <option value="">Select Improvement</option>
                            <option value="0">0 out of 10</option>
                            <option value="1">1 out of 10</option>
                            <option value="2">2 out of 10</option>
                            <option value="3">3 out of 10</option>
                            <option value="4">4 out of 10</option>
                            <option value="5">5 out of 10</option>
                            <option value="6">6 out of 10</option>
                            <option value="7">7 out of 10</option>
                            <option value="8">8 out of 10</option>
                            <option value="9">9 out of 10</option>
                            <option value="10">10 out of 10</option>
                        </select>
                    </div>
                </div>

                <div class="clinical-section">
                    <div class="section-header">II. Objective Findings</div>

                    <!-- AROM Section -->
                    <div class="form-group">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Active Range of Movement (AROM):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="initialAromNotTested" class="checkbox" onchange="toggleInitialAromPanel()">
                                    <label for="initialAromNotTested">Not tested</label>
                                    <input type="checkbox" id="initialIncludeProm" class="checkbox" onchange="generateInitialAromFields()" style="margin-left: 20px;">
                                    <label for="initialIncludeProm">Include PROM</label>
                                </div>
                            </div>
                        </div>
                        <div id="initialAromPanel">
                            <div id="initialAromMovements"></div>
                            <!-- Toes ROM for ankle -->
                            <div id="initialToesRomSection" style="display: none;">
                                <div class="muscle-row">
                                    <div class="muscle-label">Toes Range of Motion</div>
                                    <div class="muscle-input">
                                        <input type="text" id="initialToesROM" class="form-input wide-input" placeholder="***input format, e.g.: 2/3 of full range***">
                                    </div>
                                </div>
                            </div>
                            <!-- Fingers/Toes ROM for hand/foot -->
                            <div id="initialFingersToesSection" style="display: none;">
                                <div class="section-header" id="initialFingersToesHeader">Fingers Range of Motion</div>
                                <div id="initialFingersToesContainer"></div>
                                <button type="button" class="btn btn-small btn-secondary" onclick="addInitialFingerToe()">Add Finger</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hand Grip Strength Section -->
                    <div class="form-group" id="initialHandGripGroup" style="display: none;">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Hand Grip Strength Testing:</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="initialHandGripNotTested" class="checkbox" onchange="toggleInitialHandGripPanel()">
                                    <label for="initialHandGripNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="initialHandGripPanel">
                            <div class="grid-3">
                                <div class="grid-3-col"><strong>Test Type</strong></div>
                                <div class="grid-3-col"><strong>Left (kgf)</strong></div>
                                <div class="grid-3-col"><strong>Right (kgf)</strong></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Hand Grip</div>
                                <div class="grid-3-col"><input type="number" id="initialLeftHandGrip" class="form-input" step="0.1" placeholder="e.g., 25"></div>
                                <div class="grid-3-col"><input type="number" id="initialRightHandGrip" class="form-input" step="0.1" placeholder="e.g., 28"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Pinch Grip</div>
                                <div class="grid-3-col"><input type="number" id="initialLeftPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                                <div class="grid-3-col"><input type="number" id="initialRightPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Lateral Pinch</div>
                                <div class="grid-3-col"><input type="number" id="initialLeftLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                                <div class="grid-3-col"><input type="number" id="initialRightLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Muscle Power Section -->
                    <div class="form-group" id="initialMusclePowerGroup">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label" id="initialMusclePowerLabel">Muscle Power (Oxford Manual Muscle Testing Scale):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="initialMusclePowerNotTested" class="checkbox" onchange="toggleInitialMusclePowerPanel()">
                                    <label for="initialMusclePowerNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="initialMusclePowerPanel">
                            <div class="auto-fill-section" id="initialAutoFillSection">
                                <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all muscle groups, then modify individual groups as needed.</div>
                                <div class="auto-fill-controls">
                                    <div class="auto-fill-col">
                                        <select id="initialAutoFillGrade" class="form-select small-input" onchange="autoFillInitialMuscles()">
                                            <option value="">Grade</option>
                                            <option value="0">0/5</option>
                                            <option value="1">1/5</option>
                                            <option value="2">2/5</option>
                                            <option value="3">3/5</option>
                                            <option value="4">4/5</option>
                                            <option value="5">5/5</option>
                                        </select>
                                    </div>
                                    <div class="auto-fill-col">
                                        <span id="initialAutoFillLabel">Apply to all muscle groups</span>
                                    </div>
                                    <div class="auto-fill-col">
                                        <button type="button" class="btn btn-small btn-secondary" onclick="clearInitialMuscles()">Clear All</button>
                                    </div>
                                </div>
                            </div>
                            <div id="initialMusclePowerContainer"></div>
                        </div>
                    </div>

                    <!-- Myotome Section -->
                    <div class="form-group" id="initialMyotomeGroup" style="display: none;">
                        <label class="form-label">Myotome Testing:</label>
                        <div class="auto-fill-section">
                            <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all levels, then modify individual levels as needed.</div>
                            <div class="auto-fill-controls">
                                <div class="auto-fill-col">
                                    <select id="initialMyotomeAutoFill" class="form-select small-input" onchange="autoFillInitialMyotome()">
                                        <option value="">Grade</option>
                                        <option value="0">0/5</option>
                                        <option value="1">1/5</option>
                                        <option value="2">2/5</option>
                                        <option value="3">3/5</option>
                                        <option value="4">4/5</option>
                                        <option value="5">5/5</option>
                                    </select>
                                </div>
                                <div class="auto-fill-col">
                                    <span>Auto-fill all levels</span>
                                </div>
                            </div>
                        </div>
                        <div id="initialMyotomeContainer"></div>
                    </div>

                    <!-- Assessment Fields -->
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialTenderness" class="checkbox" onchange="toggleInitialTenderness()">
                            <label for="initialTenderness">Include tenderness finding</label>
                        </div>
                        <div id="initialTendernessField" class="hidden">
                            <label class="form-label">Tenderness Area:</label>
                            <input type="text" id="initialTendernessArea" class="form-input" placeholder="e.g., lateral epicondyle">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialSwelling" class="checkbox" onchange="toggleInitialSwelling()">
                            <label for="initialSwelling">Include swelling assessment</label>
                        </div>
                        <div id="initialSwellingField" class="hidden">
                            <label class="form-label">Swelling Present?</label>
                            <div>
                                <input type="radio" name="initialSwellingPresent" value="yes" id="initialSwellingYes">
                                <label for="initialSwellingYes">Yes</label>
                                <input type="radio" name="initialSwellingPresent" value="no" id="initialSwellingNo" style="margin-left: 20px;">
                                <label for="initialSwellingNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialTemperature" class="checkbox" onchange="toggleInitialTemperature()">
                            <label for="initialTemperature">Include temperature assessment</label>
                        </div>
                        <div id="initialTemperatureField" class="hidden">
                            <label class="form-label">Increased Temperature?</label>
                            <div>
                                <input type="radio" name="initialTemperatureIncreased" value="yes" id="initialTempYes">
                                <label for="initialTempYes">Yes</label>
                                <input type="radio" name="initialTemperatureIncreased" value="no" id="initialTempNo" style="margin-left: 20px;">
                                <label for="initialTempNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialSensation" class="checkbox" onchange="toggleInitialSensation()">
                            <label for="initialSensation">Include sensation assessment</label>
                        </div>
                        <div id="initialSensationField" class="hidden">
                            <label class="form-label">Sensation Status:</label>
                            <select id="initialSensationStatus" class="form-select" onchange="toggleInitialSensationDetails()">
                                <option value="intact">Intact</option>
                                <option value="reduced">Reduced</option>
                                <option value="hypersensitive">Hypersensitivity</option>
                            </select>
                            <div id="initialSensationReducedDetails" class="hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label class="form-label">Reduction Percentage:</label>
                                        <input type="text" id="initialSensationReduction" class="form-input" placeholder="e.g., 50%">
                                    </div>
                                    <div class="form-col">
                                        <label class="form-label">Over Which Area:</label>
                                        <input type="text" id="initialAreaReduced" class="form-input" placeholder="e.g., dorsal aspect of hand">
                                    </div>
                                </div>
                            </div>
                            <div id="initialSensationHypersensitiveDetails" class="hidden">
                                <label class="form-label">Over Which Area:</label>
                                <input type="text" id="initialAreaHypersensitive" class="form-input" placeholder="e.g., dorsal aspect of hand">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialReflex" class="checkbox" onchange="toggleInitialReflex()">
                            <label for="initialReflex">Include reflex finding</label>
                        </div>
                        <div id="initialReflexField" class="hidden">
                            <label class="form-label">Reflex:</label>
                            <div>
                                <input type="radio" name="initialReflexStatus" value="normal" id="initialReflexNormal">
                                <label for="initialReflexNormal">Normal</label>
                                <input type="radio" name="initialReflexStatus" value="abnormal" id="initialReflexAbnormal" style="margin-left: 20px;">
                                <label for="initialReflexAbnormal">Abnormal</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Walking Aid:</label>
                            <select id="initialWalkingAid" class="form-select">
                                <option value="">Select Aid</option>
                                <option value="unaided">Unaided</option>
                                <option value="stick">Stick</option>
                                <option value="quadruped">Quadruped</option>
                                <option value="frame">Frame</option>
                                <option value="elbow crutches">Elbow Crutches</option>
                                <option value="rollator">Rollator</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Walking Stability:</label>
                            <select id="initialWalkingStability" class="form-select">
                                <option value="">Select Stability</option>
                                <option value="good">Good</option>
                                <option value="normal">Normal</option>
                                <option value="acceptable">Acceptable</option>
                                <option value="satisfactory">Satisfactory</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="initialWbStatus" class="checkbox" onchange="toggleInitialWbStatus()">
                            <label for="initialWbStatus">Include weight bearing status</label>
                        </div>
                        <div id="initialWbStatusField" class="hidden">
                            <label class="form-label">Weight Bearing Status:</label>
                            <select id="initialWbStatusValue" class="form-select">
                                <option value="">Select Status</option>
                                <option value="full">Full weight bearing</option>
                                <option value="partial">Partial weight bearing</option>
                                <option value="toe touch">Toe touch weight bearing</option>
                                <option value="non">Non weight bearing</option>
                            </select>
                        </div>
                    </div>

                    <!-- Special Tests -->
                    <div class="form-group">
                        <label class="form-label">Special Tests:</label>
                        <div id="initialSpecialTests">
                            <div class="grid-2">
                                <div class="grid-2-col">
                                    <input type="text" class="form-input special-test-name" placeholder="Enter test name">
                                </div>
                                <div class="grid-2-col">
                                    <select class="form-select special-test-result">
                                        <option value="">Select Result</option>
                                        <option value="positive">Positive</option>
                                        <option value="negative">Negative</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-small btn-secondary" onclick="addInitialSpecialTest()">Add Special Test</button>
                    </div>

                    <!-- Questionnaire -->
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Questionnaire:</label>
                            <select id="initialQuestionnaire" class="form-select">
                                <option value="">Select Questionnaire</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Score:</label>
                            <input type="text" id="initialQuestionnaireScore" class="form-input" placeholder="Enter score">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="copyToInterim()">Copy to Interim Findings</button>
                    <button type="button" class="btn btn-secondary" onclick="copyToFinal()">Copy to Final Findings</button>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('interim')">Go to Interim Findings</button>
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('final')">Go to Final Findings</button>
                </div>
            </div>

            <!-- Interim Clinical Findings -->
            <div id="interim-clinical" class="clinical-content">
                <h3>Interim Clinical Findings</h3>
                
                <div class="form-group">
                    <label class="form-label">Date:</label>
                    <input type="date" id="interimDate" class="form-input">
                </div>

                <div class="clinical-section">
                    <div class="section-header">I. Patient's Complaints</div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Side:</label>
                            <select id="interimSide" class="form-select" onchange="updateInterimRegionFields()">
                                <option value="">Select Side</option>
                                <option value="Right">Right</option>
                                <option value="Left">Left</option>
                                <option value="Bilateral">Bilateral</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Pain Region:</label>
                            <select id="interimLocation" class="form-select" onchange="updateInterimRegionFields()">
                                <option value="">Select Region</option>
                                <option value="back">Back</option>
                                <option value="neck">Neck</option>
                                <option value="shoulder">Shoulder</option>
                                <option value="elbow">Elbow</option>
                                <option value="wrist">Wrist</option>
                                <option value="hand">Hand</option>
                                <option value="hip">Hip</option>
                                <option value="knee">Knee</option>
                                <option value="ankle">Ankle</option>
                                <option value="foot">Foot</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Pain Intensity (NPRS):</label>
                            <input type="number" id="interimPainIntensity" class="form-input" min="0" max="10" placeholder="0-10">
                        </div>
                        <div class="form-col">
                            <label class="form-label">Other Symptoms:</label>
                            <input type="text" id="interimOtherSymptoms" class="form-input" placeholder="e.g., tingling, numbness">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Other symptoms intensity:</label>
                        <input type="text" id="interimSymptomsIntensity" class="form-input" placeholder="e.g., 5 or 4-6">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Sitting/Reading:</label>
                        <div class="grid-3">
                            <div class="grid-3-col">
                                <select id="interimActivity1" class="form-select">
                                    <option value="">Select activity</option>
                                    <option value="reading">Reading</option>
                                    <option value="sitting">Sitting</option>
                                </select>
                            </div>
                            <div class="grid-3-col">
                                <input type="text" id="interimActivity1Duration" class="form-input" placeholder="e.g., 30">
                            </div>
                            <div class="grid-3-col">
                                <select id="interimActivity1Unit" class="form-select">
                                    <option value="minutes">Minutes</option>
                                    <option value="hours">Hours</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Walking/Standing:</label>
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="interimActivity2" class="form-select">
                                            <option value="">Select activity</option>
                                            <option value="walking">Walking</option>
                                            <option value="standing">Standing</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <input type="text" id="interimActivity2Duration" class="form-input" placeholder="e.g., 10">
                                    </div>
                                </div>
                            </div>
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="interimActivity2Unit" class="form-select">
                                            <option value="minutes">Minutes</option>
                                            <option value="hours">Hours</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <select id="interimActivity2Aid" class="form-select">
                                            <option value="">Select Aid</option>
                                            <option value="unaided">Unaided</option>
                                            <option value="stick">Stick</option>
                                            <option value="quadruped">Quadruped</option>
                                            <option value="frame">Frame</option>
                                            <option value="elbow crutches">Elbow Crutches</option>
                                            <option value="rollator">Rollator</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small btn-secondary" onclick="addInterimFunctionalActivity()">Add More Functional Activities</button>
                    <div id="interimAdditionalActivities"></div>

                    <div class="form-group">
                        <label class="form-label">Other Functional Activities:</label>
                        <textarea id="interimOtherFunctionalActivities" class="form-textarea" placeholder="Describe other functional activities"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Overall Subjective Improvement (NGRCS):</label>
                        <select id="interimOverallImprovement" class="form-select">
                            <option value="">Select Improvement</option>
                            <option value="0">0 out of 10</option>
                            <option value="1">1 out of 10</option>
                            <option value="2">2 out of 10</option>
                            <option value="3">3 out of 10</option>
                            <option value="4">4 out of 10</option>
                            <option value="5">5 out of 10</option>
                            <option value="6">6 out of 10</option>
                            <option value="7">7 out of 10</option>
                            <option value="8">8 out of 10</option>
                            <option value="9">9 out of 10</option>
                            <option value="10">10 out of 10</option>
                        </select>
                    </div>
                </div>

                <div class="clinical-section">
                    <div class="section-header">II. Objective Findings</div>

                    <!-- AROM Section -->
                    <div class="form-group">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Active Range of Movement (AROM):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="interimAromNotTested" class="checkbox" onchange="toggleInterimAromPanel()">
                                    <label for="interimAromNotTested">Not tested</label>
                                    <input type="checkbox" id="interimIncludeProm" class="checkbox" onchange="generateInterimAromFields()" style="margin-left: 20px;">
                                    <label for="interimIncludeProm">Include PROM</label>
                                </div>
                            </div>
                        </div>
                        <div id="interimAromPanel">
                            <div id="interimAromMovements"></div>
                            <!-- Toes ROM for ankle -->
                            <div id="interimToesRomSection" style="display: none;">
                                <div class="muscle-row">
                                    <div class="muscle-label">Toes Range of Motion</div>
                                    <div class="muscle-input">
                                        <input type="text" id="interimToesROM" class="form-input wide-input" placeholder="***input format, e.g.: 2/3 of full range***">
                                    </div>
                                </div>
                            </div>
                            <!-- Fingers/Toes ROM for hand/foot -->
                            <div id="interimFingersToesSection" style="display: none;">
                                <div class="section-header" id="interimFingersToesHeader">Fingers Range of Motion</div>
                                <div id="interimFingersToesContainer"></div>
                                <button type="button" class="btn btn-small btn-secondary" onclick="addInterimFingerToe()">Add Finger</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hand Grip Strength Section -->
                    <div class="form-group" id="interimHandGripGroup" style="display: none;">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Hand Grip Strength Testing:</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="interimHandGripNotTested" class="checkbox" onchange="toggleInterimHandGripPanel()">
                                    <label for="interimHandGripNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="interimHandGripPanel">
                            <div class="grid-3">
                                <div class="grid-3-col"><strong>Test Type</strong></div>
                                <div class="grid-3-col"><strong>Left (kgf)</strong></div>
                                <div class="grid-3-col"><strong>Right (kgf)</strong></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Hand Grip</div>
                                <div class="grid-3-col"><input type="number" id="interimLeftHandGrip" class="form-input" step="0.1" placeholder="e.g., 25"></div>
                                <div class="grid-3-col"><input type="number" id="interimRightHandGrip" class="form-input" step="0.1" placeholder="e.g., 28"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Pinch Grip</div>
                                <div class="grid-3-col"><input type="number" id="interimLeftPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                                <div class="grid-3-col"><input type="number" id="interimRightPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Lateral Pinch</div>
                                <div class="grid-3-col"><input type="number" id="interimLeftLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                                <div class="grid-3-col"><input type="number" id="interimRightLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Muscle Power Section -->
                    <div class="form-group" id="interimMusclePowerGroup">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label" id="interimMusclePowerLabel">Muscle Power (Oxford Manual Muscle Testing Scale):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="interimMusclePowerNotTested" class="checkbox" onchange="toggleInterimMusclePowerPanel()">
                                    <label for="interimMusclePowerNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="interimMusclePowerPanel">
                            <div class="auto-fill-section" id="interimAutoFillSection">
                                <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all muscle groups, then modify individual groups as needed.</div>
                                <div class="auto-fill-controls">
                                    <div class="auto-fill-col">
                                        <select id="interimAutoFillGrade" class="form-select small-input" onchange="autoFillInterimMuscles()">
                                            <option value="">Grade</option>
                                            <option value="0">0/5</option>
                                            <option value="1">1/5</option>
                                            <option value="2">2/5</option>
                                            <option value="3">3/5</option>
                                            <option value="4">4/5</option>
                                            <option value="5">5/5</option>
                                        </select>
                                    </div>
                                    <div class="auto-fill-col">
                                        <span id="interimAutoFillLabel">Apply to all muscle groups</span>
                                    </div>
                                    <div class="auto-fill-col">
                                        <button type="button" class="btn btn-small btn-secondary" onclick="clearInterimMuscles()">Clear All</button>
                                    </div>
                                </div>
                            </div>
                            <div id="interimMusclePowerContainer"></div>
                        </div>
                    </div>

                    <!-- Myotome Section -->
                    <div class="form-group" id="interimMyotomeGroup" style="display: none;">
                        <label class="form-label">Myotome Testing:</label>
                        <div class="auto-fill-section">
                            <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all levels, then modify individual levels as needed.</div>
                            <div class="auto-fill-controls">
                                <div class="auto-fill-col">
                                    <select id="interimMyotomeAutoFill" class="form-select small-input" onchange="autoFillInterimMyotome()">
                                        <option value="">Grade</option>
                                        <option value="0">0/5</option>
                                        <option value="1">1/5</option>
                                        <option value="2">2/5</option>
                                        <option value="3">3/5</option>
                                        <option value="4">4/5</option>
                                        <option value="5">5/5</option>
                                    </select>
                                </div>
                                <div class="auto-fill-col">
                                    <span>Auto-fill all levels</span>
                                </div>
                            </div>
                        </div>
                        <div id="interimMyotomeContainer"></div>
                    </div>

                    <!-- Assessment Fields -->
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimTenderness" class="checkbox" onchange="toggleInterimTenderness()">
                            <label for="interimTenderness">Include tenderness finding</label>
                        </div>
                        <div id="interimTendernessField" class="hidden">
                            <label class="form-label">Tenderness Area:</label>
                            <input type="text" id="interimTendernessArea" class="form-input" placeholder="e.g., lateral epicondyle">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimSwelling" class="checkbox" onchange="toggleInterimSwelling()">
                            <label for="interimSwelling">Include swelling assessment</label>
                        </div>
                        <div id="interimSwellingField" class="hidden">
                            <label class="form-label">Swelling Present?</label>
                            <div>
                                <input type="radio" name="interimSwellingPresent" value="yes" id="interimSwellingYes">
                                <label for="interimSwellingYes">Yes</label>
                                <input type="radio" name="interimSwellingPresent" value="no" id="interimSwellingNo" style="margin-left: 20px;">
                                <label for="interimSwellingNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimTemperature" class="checkbox" onchange="toggleInterimTemperature()">
                            <label for="interimTemperature">Include temperature assessment</label>
                        </div>
                        <div id="interimTemperatureField" class="hidden">
                            <label class="form-label">Increased Temperature?</label>
                            <div>
                                <input type="radio" name="interimTemperatureIncreased" value="yes" id="interimTempYes">
                                <label for="interimTempYes">Yes</label>
                                <input type="radio" name="interimTemperatureIncreased" value="no" id="interimTempNo" style="margin-left: 20px;">
                                <label for="interimTempNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimSensation" class="checkbox" onchange="toggleInterimSensation()">
                            <label for="interimSensation">Include sensation assessment</label>
                        </div>
                        <div id="interimSensationField" class="hidden">
                            <label class="form-label">Sensation Status:</label>
                            <select id="interimSensationStatus" class="form-select" onchange="toggleInterimSensationDetails()">
                                <option value="intact">Intact</option>
                                <option value="reduced">Reduced</option>
                                <option value="hypersensitive">Hypersensitivity</option>
                            </select>
                            <div id="interimSensationReducedDetails" class="hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label class="form-label">Reduction Percentage:</label>
                                        <input type="text" id="interimSensationReduction" class="form-input" placeholder="e.g., 50%">
                                    </div>
                                    <div class="form-col">
                                        <label class="form-label">Over Which Area:</label>
                                        <input type="text" id="interimAreaReduced" class="form-input" placeholder="e.g., dorsal aspect of hand">
                                    </div>
                                </div>
                            </div>
                            <div id="interimSensationHypersensitiveDetails" class="hidden">
                                <label class="form-label">Over Which Area:</label>
                                <input type="text" id="interimAreaHypersensitive" class="form-input" placeholder="e.g., dorsal aspect of hand">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimReflex" class="checkbox" onchange="toggleInterimReflex()">
                            <label for="interimReflex">Include reflex finding</label>
                        </div>
                        <div id="interimReflexField" class="hidden">
                            <label class="form-label">Reflex:</label>
                            <div>
                                <input type="radio" name="interimReflexStatus" value="normal" id="interimReflexNormal">
                                <label for="interimReflexNormal">Normal</label>
                                <input type="radio" name="interimReflexStatus" value="abnormal" id="interimReflexAbnormal" style="margin-left: 20px;">
                                <label for="interimReflexAbnormal">Abnormal</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Walking Aid:</label>
                            <select id="interimWalkingAid" class="form-select">
                                <option value="">Select Aid</option>
                                <option value="unaided">Unaided</option>
                                <option value="stick">Stick</option>
                                <option value="quadruped">Quadruped</option>
                                <option value="frame">Frame</option>
                                <option value="elbow crutches">Elbow Crutches</option>
                                <option value="rollator">Rollator</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Walking Stability:</label>
                            <select id="interimWalkingStability" class="form-select">
                                <option value="">Select Stability</option>
                                <option value="good">Good</option>
                                <option value="normal">Normal</option>
                                <option value="acceptable">Acceptable</option>
                                <option value="satisfactory">Satisfactory</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="interimWbStatus" class="checkbox" onchange="toggleInterimWbStatus()">
                            <label for="interimWbStatus">Include weight bearing status</label>
                        </div>
                        <div id="interimWbStatusField" class="hidden">
                            <label class="form-label">Weight Bearing Status:</label>
                            <select id="interimWbStatusValue" class="form-select">
                                <option value="">Select Status</option>
                                <option value="full">Full weight bearing</option>
                                <option value="partial">Partial weight bearing</option>
                                <option value="toe touch">Toe touch weight bearing</option>
                                <option value="non">Non weight bearing</option>
                            </select>
                        </div>
                    </div>

                    <!-- Special Tests -->
                    <div class="form-group">
                        <label class="form-label">Special Tests:</label>
                        <div id="interimSpecialTests">
                            <div class="grid-2">
                                <div class="grid-2-col">
                                    <input type="text" class="form-input special-test-name" placeholder="Enter test name">
                                </div>
                                <div class="grid-2-col">
                                    <select class="form-select special-test-result">
                                        <option value="">Select Result</option>
                                        <option value="positive">Positive</option>
                                        <option value="negative">Negative</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-small btn-secondary" onclick="addInterimSpecialTest()">Add Special Test</button>
                    </div>

                    <!-- Questionnaire -->
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Questionnaire:</label>
                            <select id="interimQuestionnaire" class="form-select">
                                <option value="">Select Questionnaire</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Score:</label>
                            <input type="text" id="interimQuestionnaireScore" class="form-input" placeholder="Enter score">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="copyFromInitialToInterim()">Copy from Initial Findings</button>
                    <button type="button" class="btn btn-secondary" onclick="copyFromInterimToFinal()">Copy to Final Findings</button>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('initial')">Go to Initial Findings</button>
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('final')">Go to Final Findings</button>
                </div>
            </div>

            <!-- Final Clinical Findings -->
            <div id="final-clinical" class="clinical-content">
                <h3>Final Clinical Findings</h3>
                
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="copyFromInitialToFinal()">Copy from Initial Findings</button>
                    <button type="button" class="btn btn-secondary" onclick="copyFromInterimToFinal()">Copy from Interim Findings</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Date:</label>
                    <input type="date" id="finalDate" class="form-input">
                </div>

                <div class="clinical-section">
                    <div class="section-header">I. Patient's Complaints</div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Side:</label>
                            <select id="finalSide" class="form-select" onchange="updateFinalRegionFields()">
                                <option value="">Select Side</option>
                                <option value="Right">Right</option>
                                <option value="Left">Left</option>
                                <option value="Bilateral">Bilateral</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Pain Region:</label>
                            <select id="finalLocation" class="form-select" onchange="updateFinalRegionFields()">
                                <option value="">Select Region</option>
                                <option value="back">Back</option>
                                <option value="neck">Neck</option>
                                <option value="shoulder">Shoulder</option>
                                <option value="elbow">Elbow</option>
                                <option value="wrist">Wrist</option>
                                <option value="hand">Hand</option>
                                <option value="hip">Hip</option>
                                <option value="knee">Knee</option>
                                <option value="ankle">Ankle</option>
                                <option value="foot">Foot</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Pain Intensity (NPRS):</label>
                            <input type="number" id="finalPainIntensity" class="form-input" min="0" max="10" placeholder="0-10">
                        </div>
                        <div class="form-col">
                            <label class="form-label">Other Symptoms:</label>
                            <input type="text" id="finalOtherSymptoms" class="form-input" placeholder="e.g., tingling, numbness">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Other symptoms intensity:</label>
                        <input type="text" id="finalSymptomsIntensity" class="form-input" placeholder="e.g., 5 or 4-6">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Sitting/Reading:</label>
                        <div class="grid-3">
                            <div class="grid-3-col">
                                <select id="finalActivity1" class="form-select">
                                    <option value="">Select activity</option>
                                    <option value="reading">Reading</option>
                                    <option value="sitting">Sitting</option>
                                </select>
                            </div>
                            <div class="grid-3-col">
                                <input type="text" id="finalActivity1Duration" class="form-input" placeholder="e.g., 30">
                            </div>
                            <div class="grid-3-col">
                                <select id="finalActivity1Unit" class="form-select">
                                    <option value="minutes">Minutes</option>
                                    <option value="hours">Hours</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Functional Activity - Walking/Standing:</label>
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="finalActivity2" class="form-select">
                                            <option value="">Select activity</option>
                                            <option value="walking">Walking</option>
                                            <option value="standing">Standing</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <input type="text" id="finalActivity2Duration" class="form-input" placeholder="e.g., 10">
                                    </div>
                                </div>
                            </div>
                            <div class="grid-2-col">
                                <div class="grid-2">
                                    <div class="grid-2-col">
                                        <select id="finalActivity2Unit" class="form-select">
                                            <option value="minutes">Minutes</option>
                                            <option value="hours">Hours</option>
                                        </select>
                                    </div>
                                    <div class="grid-2-col">
                                        <select id="finalActivity2Aid" class="form-select">
                                            <option value="">Select Aid</option>
                                            <option value="unaided">Unaided</option>
                                            <option value="stick">Stick</option>
                                            <option value="quadruped">Quadruped</option>
                                            <option value="frame">Frame</option>
                                            <option value="elbow crutches">Elbow Crutches</option>
                                            <option value="rollator">Rollator</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-small btn-secondary" onclick="addFinalFunctionalActivity()">Add More Functional Activities</button>
                    <div id="finalAdditionalActivities"></div>

                    <div class="form-group">
                        <label class="form-label">Other Functional Activities:</label>
                        <textarea id="finalOtherFunctionalActivities" class="form-textarea" placeholder="Describe other functional activities"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Overall Subjective Improvement (NGRCS):</label>
                        <select id="finalOverallImprovement" class="form-select">
                            <option value="">Select Improvement</option>
                            <option value="0">0 out of 10</option>
                            <option value="1">1 out of 10</option>
                            <option value="2">2 out of 10</option>
                            <option value="3">3 out of 10</option>
                            <option value="4">4 out of 10</option>
                            <option value="5">5 out of 10</option>
                            <option value="6">6 out of 10</option>
                            <option value="7">7 out of 10</option>
                            <option value="8">8 out of 10</option>
                            <option value="9">9 out of 10</option>
                            <option value="10">10 out of 10</option>
                        </select>
                    </div>
                </div>

                <div class="clinical-section">
                    <div class="section-header">II. Objective Findings</div>

                    <!-- AROM Section -->
                    <div class="form-group">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Active Range of Movement (AROM):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="finalAromNotTested" class="checkbox" onchange="toggleFinalAromPanel()">
                                    <label for="finalAromNotTested">Not tested</label>
                                    <input type="checkbox" id="finalIncludeProm" class="checkbox" onchange="generateFinalAromFields()" style="margin-left: 20px;">
                                    <label for="finalIncludeProm">Include PROM</label>
                                </div>
                            </div>
                        </div>
                        <div id="finalAromPanel">
                            <div id="finalAromMovements"></div>
                            <!-- Toes ROM for ankle -->
                            <div id="finalToesRomSection" style="display: none;">
                                <div class="muscle-row">
                                    <div class="muscle-label">Toes Range of Motion</div>
                                    <div class="muscle-input">
                                        <input type="text" id="finalToesROM" class="form-input wide-input" placeholder="***input format, e.g.: 2/3 of full range***">
                                    </div>
                                </div>
                            </div>
                            <!-- Fingers/Toes ROM for hand/foot -->
                            <div id="finalFingersToesSection" style="display: none;">
                                <div class="section-header" id="finalFingersToesHeader">Fingers Range of Motion</div>
                                <div id="finalFingersToesContainer"></div>
                                <button type="button" class="btn btn-small btn-secondary" onclick="addFinalFingerToe()">Add Finger</button>
                            </div>
                        </div>
                    </div>

                    <!-- Hand Grip Strength Section -->
                    <div class="form-group" id="finalHandGripGroup" style="display: none;">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label">Hand Grip Strength Testing:</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="finalHandGripNotTested" class="checkbox" onchange="toggleFinalHandGripPanel()">
                                    <label for="finalHandGripNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="finalHandGripPanel">
                            <div class="grid-3">
                                <div class="grid-3-col"><strong>Test Type</strong></div>
                                <div class="grid-3-col"><strong>Left (kgf)</strong></div>
                                <div class="grid-3-col"><strong>Right (kgf)</strong></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Hand Grip</div>
                                <div class="grid-3-col"><input type="number" id="finalLeftHandGrip" class="form-input" step="0.1" placeholder="e.g., 25"></div>
                                <div class="grid-3-col"><input type="number" id="finalRightHandGrip" class="form-input" step="0.1" placeholder="e.g., 28"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Pinch Grip</div>
                                <div class="grid-3-col"><input type="number" id="finalLeftPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                                <div class="grid-3-col"><input type="number" id="finalRightPinchGrip" class="form-input" step="0.1" placeholder="e.g., 8"></div>
                            </div>
                            <div class="grid-3">
                                <div class="grid-3-col">Lateral Pinch</div>
                                <div class="grid-3-col"><input type="number" id="finalLeftLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                                <div class="grid-3-col"><input type="number" id="finalRightLateralPinch" class="form-input" step="0.1" placeholder="e.g., 10"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Muscle Power Section -->
                    <div class="form-group" id="finalMusclePowerGroup">
                        <div class="grid-2">
                            <div class="grid-2-col">
                                <label class="form-label" id="finalMusclePowerLabel">Muscle Power (Oxford Manual Muscle Testing Scale):</label>
                            </div>
                            <div class="grid-2-col">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="finalMusclePowerNotTested" class="checkbox" onchange="toggleFinalMusclePowerPanel()">
                                    <label for="finalMusclePowerNotTested">Not tested</label>
                                </div>
                            </div>
                        </div>
                        <div id="finalMusclePowerPanel">
                            <div class="auto-fill-section" id="finalAutoFillSection">
                                <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all muscle groups, then modify individual groups as needed.</div>
                                <div class="auto-fill-controls">
                                    <div class="auto-fill-col">
                                        <select id="finalAutoFillGrade" class="form-select small-input" onchange="autoFillFinalMuscles()">
                                            <option value="">Grade</option>
                                            <option value="0">0/5</option>
                                            <option value="1">1/5</option>
                                            <option value="2">2/5</option>
                                            <option value="3">3/5</option>
                                            <option value="4">4/5</option>
                                            <option value="5">5/5</option>
                                        </select>
                                    </div>
                                    <div class="auto-fill-col">
                                        <span id="finalAutoFillLabel">Apply to all muscle groups</span>
                                    </div>
                                    <div class="auto-fill-col">
                                        <button type="button" class="btn btn-small btn-secondary" onclick="clearFinalMuscles()">Clear All</button>
                                    </div>
                                </div>
                            </div>
                            <div id="finalMusclePowerContainer"></div>
                        </div>
                    </div>

                    <!-- Myotome Section -->
                    <div class="form-group" id="finalMyotomeGroup" style="display: none;">
                        <label class="form-label">Myotome Testing:</label>
                        <div class="auto-fill-section">
                            <div class="auto-fill-text"><strong>Smart Auto-fill:</strong> Select a grade to apply to all levels, then modify individual levels as needed.</div>
                            <div class="auto-fill-controls">
                                <div class="auto-fill-col">
                                    <select id="finalMyotomeAutoFill" class="form-select small-input" onchange="autoFillFinalMyotome()">
                                        <option value="">Grade</option>
                                        <option value="0">0/5</option>
                                        <option value="1">1/5</option>
                                        <option value="2">2/5</option>
                                        <option value="3">3/5</option>
                                        <option value="4">4/5</option>
                                        <option value="5">5/5</option>
                                    </select>
                                </div>
                                <div class="auto-fill-col">
                                    <span>Auto-fill all levels</span>
                                </div>
                            </div>
                        </div>
                        <div id="finalMyotomeContainer"></div>
                    </div>

                    <!-- Assessment Fields -->
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalTenderness" class="checkbox" onchange="toggleFinalTenderness()">
                            <label for="finalTenderness">Include tenderness finding</label>
                        </div>
                        <div id="finalTendernessField" class="hidden">
                            <label class="form-label">Tenderness Area:</label>
                            <input type="text" id="finalTendernessArea" class="form-input" placeholder="e.g., lateral epicondyle">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalSwelling" class="checkbox" onchange="toggleFinalSwelling()">
                            <label for="finalSwelling">Include swelling assessment</label>
                        </div>
                        <div id="finalSwellingField" class="hidden">
                            <label class="form-label">Swelling Present?</label>
                            <div>
                                <input type="radio" name="finalSwellingPresent" value="yes" id="finalSwellingYes">
                                <label for="finalSwellingYes">Yes</label>
                                <input type="radio" name="finalSwellingPresent" value="no" id="finalSwellingNo" style="margin-left: 20px;">
                                <label for="finalSwellingNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalTemperature" class="checkbox" onchange="toggleFinalTemperature()">
                            <label for="finalTemperature">Include temperature assessment</label>
                        </div>
                        <div id="finalTemperatureField" class="hidden">
                            <label class="form-label">Increased Temperature?</label>
                            <div>
                                <input type="radio" name="finalTemperatureIncreased" value="yes" id="finalTempYes">
                                <label for="finalTempYes">Yes</label>
                                <input type="radio" name="finalTemperatureIncreased" value="no" id="finalTempNo" style="margin-left: 20px;">
                                <label for="finalTempNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalSensation" class="checkbox" onchange="toggleFinalSensation()">
                            <label for="finalSensation">Include sensation assessment</label>
                        </div>
                        <div id="finalSensationField" class="hidden">
                            <label class="form-label">Sensation Status:</label>
                            <select id="finalSensationStatus" class="form-select" onchange="toggleFinalSensationDetails()">
                                <option value="intact">Intact</option>
                                <option value="reduced">Reduced</option>
                                <option value="hypersensitive">Hypersensitivity</option>
                            </select>
                            <div id="finalSensationReducedDetails" class="hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label class="form-label">Reduction Percentage:</label>
                                        <input type="text" id="finalSensationReduction" class="form-input" placeholder="e.g., 50%">
                                    </div>
                                    <div class="form-col">
                                        <label class="form-label">Over Which Area:</label>
                                        <input type="text" id="finalAreaReduced" class="form-input" placeholder="e.g., dorsal aspect of hand">
                                    </div>
                                </div>
                            </div>
                            <div id="finalSensationHypersensitiveDetails" class="hidden">
                                <label class="form-label">Over Which Area:</label>
                                <input type="text" id="finalAreaHypersensitive" class="form-input" placeholder="e.g., dorsal aspect of hand">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalReflex" class="checkbox" onchange="toggleFinalReflex()">
                            <label for="finalReflex">Include reflex finding</label>
                        </div>
                        <div id="finalReflexField" class="hidden">
                            <label class="form-label">Reflex:</label>
                            <div>
                                <input type="radio" name="finalReflexStatus" value="normal" id="finalReflexNormal">
                                <label for="finalReflexNormal">Normal</label>
                                <input type="radio" name="finalReflexStatus" value="abnormal" id="finalReflexAbnormal" style="margin-left: 20px;">
                                <label for="finalReflexAbnormal">Abnormal</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Walking Aid:</label>
                            <select id="finalWalkingAid" class="form-select">
                                <option value="">Select Aid</option>
                                <option value="unaided">Unaided</option>
                                <option value="stick">Stick</option>
                                <option value="quadruped">Quadruped</option>
                                <option value="frame">Frame</option>
                                <option value="elbow crutches">Elbow Crutches</option>
                                <option value="rollator">Rollator</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Walking Stability:</label>
                            <select id="finalWalkingStability" class="form-select">
                                <option value="">Select Stability</option>
                                <option value="good">Good</option>
                                <option value="normal">Normal</option>
                                <option value="acceptable">Acceptable</option>
                                <option value="satisfactory">Satisfactory</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="finalWbStatus" class="checkbox" onchange="toggleFinalWbStatus()">
                            <label for="finalWbStatus">Include weight bearing status</label>
                        </div>
                        <div id="finalWbStatusField" class="hidden">
                            <label class="form-label">Weight Bearing Status:</label>
                            <select id="finalWbStatusValue" class="form-select">
                                <option value="">Select Status</option>
                                <option value="full">Full weight bearing</option>
                                <option value="partial">Partial weight bearing</option>
                                <option value="toe touch">Toe touch weight bearing</option>
                                <option value="non">Non weight bearing</option>
                            </select>
                        </div>
                    </div>

                    <!-- Special Tests -->
                    <div class="form-group">
                        <label class="form-label">Special Tests:</label>
                        <div id="finalSpecialTests">
                            <div class="grid-2">
                                <div class="grid-2-col">
                                    <input type="text" class="form-input special-test-name" placeholder="Enter test name">
                                </div>
                                <div class="grid-2-col">
                                    <select class="form-select special-test-result">
                                        <option value="">Select Result</option>
                                        <option value="positive">Positive</option>
                                        <option value="negative">Negative</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-small btn-secondary" onclick="addFinalSpecialTest()">Add Special Test</button>
                    </div>

                    <!-- Questionnaire -->
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Questionnaire:</label>
                            <select id="finalQuestionnaire" class="form-select">
                                <option value="">Select Questionnaire</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label class="form-label">Score:</label>
                            <input type="text" id="finalQuestionnaireScore" class="form-input" placeholder="Enter score">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('initial')">Go to Initial Findings</button>
                    <button type="button" class="btn btn-primary" onclick="jumpToClinicalTab('interim')">Go to Interim Findings</button>
                </div>
            </div>
        </div>

        <!-- Section 7: Treatment Methods -->
        <div id="section7" class="section">
            <h2 class="section-title">Section 7: Treatment Methods</h2>
            
            <div style="display: table; width: 100%;">
                <div style="display: table-row;">
                    <div style="display: table-cell; width: 33%; padding-right: 20px; vertical-align: top;">
                        <div class="clinical-section">
                            <h4>Thermal Therapy</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="hotPack" class="checkbox">
                                <label for="hotPack">Hot pack</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="coldPack" class="checkbox">
                                <label for="coldPack">Cold pack</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="waxTherapy" class="checkbox">
                                <label for="waxTherapy">Wax therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="hydrotherapy" class="checkbox">
                                <label for="hydrotherapy">Hydrotherapy</label>
                            </div>
                        </div>

                        <div class="clinical-section">
                            <h4>Traction Therapy</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="intermittentLumbarTraction" class="checkbox">
                                <label for="intermittentLumbarTraction">Intermittent lumbar traction</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="intermittentNeckTraction" class="checkbox">
                                <label for="intermittentNeckTraction">Intermittent neck traction</label>
                            </div>
                        </div>

                        <div class="clinical-section">
                            <h4>Manual Therapy</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="manualTherapy" class="checkbox">
                                <label for="manualTherapy">Manual therapy</label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: table-cell; width: 33%; padding-right: 20px; vertical-align: top;">
                        <div class="clinical-section">
                            <h4>Exercise Therapy</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="mobilizationExercise" class="checkbox">
                                <label for="mobilizationExercise">Mobilization exercise</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="strengtheningExercise" class="checkbox">
                                <label for="strengtheningExercise">Strengthening exercise</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="exerciseTherapy" class="checkbox">
                                <label for="exerciseTherapy">Exercise therapy</label>
                            </div>
                        </div>

                        <div class="clinical-section">
                            <h4>Functional Training</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="balanceTraining" class="checkbox">
                                <label for="balanceTraining">Balance training</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="gaitTraining" class="checkbox">
                                <label for="gaitTraining">Gait training</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="functionalTraining" class="checkbox">
                                <label for="functionalTraining">Functional training</label>
                            </div>
                        </div>

                        <div class="clinical-section">
                            <h4>Others</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="desensitization" class="checkbox">
                                <label for="desensitization">De-sensitization training</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="acupuncture" class="checkbox">
                                <label for="acupuncture">Acupuncture</label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: table-cell; width: 33%; vertical-align: top;">
                        <div class="clinical-section">
                            <h4>Electrical Therapy</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="interferential" class="checkbox">
                                <label for="interferential">Interferential electrical therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="nmes" class="checkbox">
                                <label for="nmes">Neuromuscular electrical stimulation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="tens" class="checkbox">
                                <label for="tens">Transcutaneous Electrical Nerve Stimulation (TENS)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ultrasound" class="checkbox">
                                <label for="ultrasound">Ultrasound therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="pulsedElectromagnetic" class="checkbox">
                                <label for="pulsedElectromagnetic">Pulsed electromagnetic field therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="shockwave" class="checkbox">
                                <label for="shockwave">Shockwave therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="microCurrent" class="checkbox">
                                <label for="microCurrent">Micro-current therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="infraredLight" class="checkbox">
                                <label for="infraredLight">Infrared light therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="polarizedPolychromatic" class="checkbox">
                                <label for="polarizedPolychromatic">Polarized polychromatic light therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="highElectromagnetic" class="checkbox">
                                <label for="highElectromagnetic">High electromagnetic inductive therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="pulsedShortwave" class="checkbox">
                                <label for="pulsedShortwave">Pulsed shortwave therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="flowpulse" class="checkbox">
                                <label for="flowpulse">Flowpulse therapy</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="laser" class="checkbox">
                                <label for="laser">Laser therapy</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Other Treatment:</label>
                <textarea id="otherTreatment" class="form-textarea" placeholder="Describe other treatments"></textarea>
            </div>
        </div>

        <!-- Section 8: Discharge Summary -->
        <div id="section8" class="section">
            <h2 class="section-title">Section 8: Discharge Summary</h2>
            
            <div class="form-group">
                <label class="form-label">Discharge Type:</label>
                <select id="dischargeType" class="form-select" onchange="updateDischargeFields()">
                    <option value="">Select discharge type</option>
                    <option value="completed">Discharged</option>
                    <option value="static">Discharged with static progress</option>
                    <option value="ongoing">Still receiving physiotherapy</option>
                    <option value="defaulted">Defaulted</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>

            <!-- Discharge Date (for completed and static) -->
            <div id="dischargeDateGroup" class="form-group" style="display: none;">
                <label class="form-label">Discharge Date:</label>
                <input type="date" id="dischargeDate" class="form-input">
            </div>

            <!-- Default Date (for defaulted) -->
            <div id="defaultDateGroup" class="form-group" style="display: none;">
                <label class="form-label">Default Date:</label>
                <input type="date" id="defaultDate" class="form-input">
            </div>

            <!-- Cancellation Fields (for cancelled) -->
            <div id="cancellationGroup" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">Cancellation Date:</label>
                        <input type="date" id="cancellationDate" class="form-input">
                    </div>
                    <div class="form-col">
                        <label class="form-label">Scheduled Appointment Date:</label>
                        <input type="date" id="scheduledAppointmentDate" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Cancellation Reason:</label>
                    <textarea id="cancellationReason" class="form-textarea" placeholder="Enter cancellation reason"></textarea>
                </div>
            </div>
        </div>

        <!-- Section 9: Declaration -->
        <div id="section9" class="section">
            <h2 class="section-title">Section 9: Declaration</h2>
            
            <div class="form-group">
                <label class="form-label">Consent Date for Declaration:</label>
                <input type="date" id="consentDate" class="form-input">
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label">Name:</label>
                    <input type="text" id="therapistName" class="form-input" placeholder="Therapist full name">
                </div>
                <div class="form-col">
                    <label class="form-label">Title:</label>
                    <input type="text" id="therapistTitle" class="form-input" placeholder="e.g., Physiotherapist I">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Education Qualifications:</label>
                <textarea id="educationQualifications" class="form-textarea" placeholder="Enter education qualifications"></textarea>
            </div>
        </div>

        <!-- Data Export Section -->
        <div class="export-section">
            <h3>Data Export</h3>
            <p>Generate a data string that can be imported into the full app for identical report generation.</p>
            
            <button type="button" class="btn btn-primary" onclick="generateDataString()">Generate Data String</button>
            
            <div class="export-output" id="exportOutput">
                Click "Generate Data String" to create exportable data...
            </div>
            
            <button type="button" class="btn btn-success" onclick="copyDataString()">Copy Data String</button>
        </div>
    </div>

    <script>
        // Global variables - ES3/ES4 compatible
        var currentSection = 1;
        var currentClinicalTab = 'initial';
        // Separate data objects for each section (like React components)
        var sectionData = {
            initial: {
                fingersToesData: [],
                fingerToeCounter: 0
            },
            interim: {
                fingersToesData: [],
                fingerToeCounter: 0
            },
            final: {
                fingersToesData: [],
                fingerToeCounter: 0
            }
        };
        
        // Keep backward compatibility
        var fingersToesData = sectionData.initial.fingersToesData;

        // Navigation functions
        function showSection(sectionNum) {
            var i;
            var sections = document.getElementsByClassName('section');
            var tabs = document.getElementsByClassName('nav-tab');
            
            for (i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            for (i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            document.getElementById('section' + sectionNum).classList.add('active');
            tabs[sectionNum - 1].classList.add('active');
            currentSection = sectionNum;
        }

        function showClinicalTab(tabName) {
            var i;
            var contents = document.getElementsByClassName('clinical-content');
            var tabs = document.getElementsByClassName('clinical-tab');
            
            for (i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            for (i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            document.getElementById(tabName + '-clinical').classList.add('active');
            
            // Find and activate the correct tab
            for (i = 0; i < tabs.length; i++) {
                if ((tabName === 'initial' && i === 0) || 
                    (tabName === 'interim' && i === 1) || 
                    (tabName === 'final' && i === 2)) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            currentClinicalTab = tabName;
        }

        function jumpToClinicalTab(tabName) {
            showClinicalTab(tabName);
            // Scroll to the start of the clinical content
            var element = document.getElementById(tabName + '-clinical');
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Region-specific field updates
        function updateInitialRegionFields() {
            var location = document.getElementById('initialLocation').value;
            var side = document.getElementById('initialSide').value;
            
            // Show/hide toes ROM for ankle
            var toesRomSection = document.getElementById('initialToesRomSection');
            if (toesRomSection) {
                if (location === 'ankle') {
                    toesRomSection.style.display = 'block';
                } else {
                    toesRomSection.style.display = 'none';
                }
            }

            // Show/hide fingers/toes ROM for hand/foot
            var fingersToesSection = document.getElementById('initialFingersToesSection');
            var fingersToesHeader = document.getElementById('initialFingersToesHeader');
            if (fingersToesSection && fingersToesHeader) {
                if (location === 'hand' || location === 'foot') {
                    fingersToesSection.style.display = 'block';
                    fingersToesHeader.textContent = (location === 'hand' ? 'Fingers' : 'Toes') + ' Range of Motion';
                    // Update button text
                    var addButton = fingersToesSection.querySelector('button');
                    if (addButton) {
                        addButton.textContent = 'Add ' + (location === 'hand' ? 'Finger' : 'Toe');
                    }
                } else {
                    fingersToesSection.style.display = 'none';
                }
            }

            // Show/hide hand grip for hand
            var handGripGroup = document.getElementById('initialHandGripGroup');
            if (handGripGroup) {
                if (location === 'hand') {
                    handGripGroup.style.display = 'block';
                } else {
                    handGripGroup.style.display = 'none';
                }
            }

            // Show/hide myotome for back/neck
            var myotomeGroup = document.getElementById('initialMyotomeGroup');
            if (myotomeGroup) {
                if (location === 'back' || location === 'neck') {
                    myotomeGroup.style.display = 'block';
                    generateInitialMyotomeFields(location);
                } else {
                    myotomeGroup.style.display = 'none';
                }
            }

            // Update muscle power label and auto-fill section
            var musclePowerLabel = document.getElementById('initialMusclePowerLabel');
            var autoFillLabel = document.getElementById('initialAutoFillLabel');
            var autoFillSection = document.getElementById('initialAutoFillSection');
            
            if (location === 'back' || location === 'neck') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Myotome Testing:';
                if (autoFillLabel) autoFillLabel.textContent = 'Auto-fill all levels';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else if (location === 'hand') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Hand Grip Strength Testing:';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Muscle Power (Oxford Manual Muscle Testing Scale):';
                if (autoFillLabel) autoFillLabel.textContent = 'Apply to all muscle groups';
                if (autoFillSection) autoFillSection.style.display = 'block';
            }

            // Update AROM movements
            generateInitialAromFields();

            // Update muscle power groups
            generateInitialMusclePowerFields(location, side);

            // Update questionnaires
            updateInitialQuestionnaires(location);
        }

        // AROM field generation
        function generateInitialAromFields() {
            var location = document.getElementById('initialLocation').value;
            var container = document.getElementById('initialAromMovements');
            if (!container) return;

            var movements = getAromMovements(location);
            container.innerHTML = '';

            if (movements.length === 0) return;

            var includeProm = document.getElementById('initialIncludeProm').checked;
            var isBackNeck = (location === 'back' || location === 'neck');
            
            for (var i = 0; i < movements.length; i++) {
                var movementDiv = document.createElement('div');
                movementDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + movements[i] + '</div>';
                html += '<div class="muscle-input">';
                html += '<input type="text" class="form-input small-input arom-value" placeholder="' + 
                        (isBackNeck ? 'e.g., 3/5' : 'e.g., 90') + '">';
                
                if (includeProm) {
                    html += '<input type="text" class="form-input small-input prom-value" placeholder="' + 
                            (isBackNeck ? 'e.g., 4/5' : 'e.g., 95') + '" style="margin-left: 10px;">';
                }
                
                html += '</div>';
                movementDiv.innerHTML = html;
                container.appendChild(movementDiv);
            }
        }

        function getAromMovements(location) {
            var movements = {
                'back': ['Flexion', 'Extension', 'Right Rotation', 'Left Rotation', 'Right Side Flexion', 'Left Side Flexion'],
                'neck': ['Flexion', 'Extension', 'Right Rotation', 'Left Rotation', 'Right Side Flexion', 'Left Side Flexion'],
                'shoulder': ['Flexion', 'Abduction', 'Extension', 'External Rotation', 'Internal Rotation', 'Hand behind back', 'Hand behind neck'],
                'elbow': ['Flexion', 'Extension', 'Pronation', 'Supination'],
                'wrist': ['Flexion', 'Extension', 'Pronation', 'Supination', 'Radial Deviation', 'Ulnar Deviation'],
                'hip': ['Flexion', 'Abduction', 'Extension', 'External Rotation', 'Internal Rotation'],
                'knee': ['Flexion', 'Extension'],
                'ankle': ['Plantarflexion', 'Dorsiflexion', 'Eversion', 'Inversion'],
                'hand': [],
                'foot': []
            };
            return movements[location] || [];
        }

        // Fingers/Toes functions
        function addInitialFingerToe() {
            var location = document.getElementById('initialLocation').value;
            var container = document.getElementById('initialFingersToesContainer');
            if (!container) return;

            var fingerToeIndex = 'initial_' + fingersToesData.length;
            var fingerToeData = { name: '', joints: [] };
            fingersToesData.push(fingerToeData);

            var fingerToeDiv = document.createElement('div');
            fingerToeDiv.className = 'finger-toe-panel';
            fingerToeDiv.setAttribute('data-index', fingerToeIndex);

            var html = '<div class="finger-toe-header">';
            html += '<div class="finger-toe-name">';
            html += '<label class="form-label">' + (location === 'hand' ? 'Finger' : 'Toe') + ' Name</label>';
            html += '<input type="text" class="form-input finger-toe-name-input" placeholder="' + 
                    (location === 'hand' ? 'e.g., Middle finger' : 'e.g., 2nd toe') + '" onchange="updateFingerToeName(' + fingerToeIndex + ', this.value)">';
            html += '</div>';
            
            if (fingersToesData.length > 1) {
                html += '<div class="finger-toe-remove">';
                html += '<button type="button" class="btn btn-small btn-secondary" onclick="removeFingerToe(' + fingerToeIndex + ')">Remove</button>';
                html += '</div>';
            }
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label class="form-label">Small Joints</label>';
            html += '<div class="joint-checkboxes">';
            
            var jointOptions = getSmallJointOptions(location);
            var halfLength = Math.ceil(jointOptions.length / 2);
            
            html += '<div class="joint-checkbox-col">';
            for (var i = 0; i < halfLength; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked)">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="joint-checkbox-col">';
            for (var i = halfLength; i < jointOptions.length; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked)">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';

            html += '<div class="joint-ranges" id="joint-ranges-' + fingerToeIndex + '"></div>';
            html += '</div>';

            fingerToeDiv.innerHTML = html;
            container.appendChild(fingerToeDiv);
        }
        
        // Interim Fingers/Toes functions
        function addInterimFingerToe() {
            var location = document.getElementById('interimLocation').value;
            var container = document.getElementById('interimFingersToesContainer');
            if (!container) return;

            var fingerToeIndex = 'interim_' + interimFingersToesData.length;
            var fingerToeData = { name: '', joints: [] };
            interimFingersToesData.push(fingerToeData);

            var fingerToeDiv = document.createElement('div');
            fingerToeDiv.className = 'finger-toe-panel';
            fingerToeDiv.setAttribute('data-index', fingerToeIndex);

            var html = '<div class="finger-toe-header">';
            html += '<div class="finger-toe-name">';
            html += '<label class="form-label">' + (location === 'hand' ? 'Finger' : 'Toe') + ' Name</label>';
            html += '<input type="text" class="form-input finger-toe-name-input" placeholder="' + 
                    (location === 'hand' ? 'e.g., Middle finger' : 'e.g., 2nd toe') + '" onchange="updateFingerToeName(' + fingerToeIndex + ', this.value, \'interim\')">';
            html += '</div>';
            
            if (interimFingersToesData.length > 1) {
                html += '<div class="finger-toe-remove">';
                html += '<button type="button" class="btn btn-small btn-secondary" onclick="removeFingerToe(' + fingerToeIndex + ')">Remove</button>';
                html += '</div>';
            }
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label class="form-label">Small Joints</label>';
            html += '<div class="joint-checkboxes">';
            
            var jointOptions = getSmallJointOptions(location);
            var halfLength = Math.ceil(jointOptions.length / 2);
            
            html += '<div class="joint-checkbox-col">';
            for (var i = 0; i < halfLength; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked, \'interim\')">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="joint-checkbox-col">';
            for (var i = halfLength; i < jointOptions.length; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked, \'interim\')">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';

            html += '<div class="joint-ranges" id="joint-ranges-' + fingerToeIndex + '"></div>';
            html += '</div>';

            fingerToeDiv.innerHTML = html;
            container.appendChild(fingerToeDiv);
        }
        
        // Final Fingers/Toes functions
        function addFinalFingerToe() {
            var location = document.getElementById('finalLocation').value;
            var container = document.getElementById('finalFingersToesContainer');
            if (!container) return;

            var fingerToeIndex = 'final_' + finalFingersToesData.length;
            var fingerToeData = { name: '', joints: [] };
            finalFingersToesData.push(fingerToeData);

            var fingerToeDiv = document.createElement('div');
            fingerToeDiv.className = 'finger-toe-panel';
            fingerToeDiv.setAttribute('data-index', fingerToeIndex);

            var html = '<div class="finger-toe-header">';
            html += '<div class="finger-toe-name">';
            html += '<label class="form-label">' + (location === 'hand' ? 'Finger' : 'Toe') + ' Name</label>';
            html += '<input type="text" class="form-input finger-toe-name-input" placeholder="' + 
                    (location === 'hand' ? 'e.g., Middle finger' : 'e.g., 2nd toe') + '" onchange="updateFingerToeName(' + fingerToeIndex + ', this.value, \'final\')">';
            html += '</div>';
            
            if (finalFingersToesData.length > 1) {
                html += '<div class="finger-toe-remove">';
                html += '<button type="button" class="btn btn-small btn-secondary" onclick="removeFingerToe(' + fingerToeIndex + ')">Remove</button>';
                html += '</div>';
            }
            html += '</div>';

            html += '<div class="form-group">';
            html += '<label class="form-label">Small Joints</label>';
            html += '<div class="joint-checkboxes">';
            
            var jointOptions = getSmallJointOptions(location);
            var halfLength = Math.ceil(jointOptions.length / 2);
            
            html += '<div class="joint-checkbox-col">';
            for (var i = 0; i < halfLength; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked, \'final\')">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="joint-checkbox-col">';
            for (var i = halfLength; i < jointOptions.length; i++) {
                html += '<div class="joint-checkbox-item">';
                html += '<input type="checkbox" id="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '" class="checkbox" onchange="toggleJoint(' + fingerToeIndex + ', \'' + jointOptions[i].value + '\', this.checked, \'final\')">';
                html += '<label for="joint_' + fingerToeIndex + '_' + jointOptions[i].value + '">' + jointOptions[i].label + '</label>';
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';

            html += '<div class="joint-ranges" id="joint-ranges-' + fingerToeIndex + '"></div>';
            html += '</div>';

            fingerToeDiv.innerHTML = html;
            container.appendChild(fingerToeDiv);
        }
        
        // Expose finger/toe functions to global scope
        window.addInterimFingerToe = addInterimFingerToe;
        window.addFinalFingerToe = addFinalFingerToe;

        function updateFingerToeName(index, name, section) {
            var dataArray;
            var numericIndex;
            
            // Parse section from index if not provided
            if (!section && typeof index === 'string') {
                if (index.startsWith('initial_')) {
                    section = 'initial';
                    numericIndex = parseInt(index.replace('initial_', ''));
                } else if (index.startsWith('interim_')) {
                    section = 'interim';
                    numericIndex = parseInt(index.replace('interim_', ''));
                } else if (index.startsWith('final_')) {
                    section = 'final';
                    numericIndex = parseInt(index.replace('final_', ''));
                }
            } else {
                numericIndex = parseInt(index);
            }
            
            if (section === 'interim') {
                dataArray = interimFingersToesData;
            } else if (section === 'final') {
                dataArray = finalFingersToesData;
            } else {
                dataArray = fingersToesData; // initial
            }
            
            if (dataArray[numericIndex]) {
                dataArray[numericIndex].name = name;
            }
        }

        function toggleJoint(fingerToeIndex, jointType, checked, section) {
            var dataArray;
            var numericIndex;
            
            // Parse section from index if not provided
            if (!section && typeof fingerToeIndex === 'string') {
                if (fingerToeIndex.startsWith('initial_')) {
                    section = 'initial';
                    numericIndex = parseInt(fingerToeIndex.replace('initial_', ''));
                } else if (fingerToeIndex.startsWith('interim_')) {
                    section = 'interim';
                    numericIndex = parseInt(fingerToeIndex.replace('interim_', ''));
                } else if (fingerToeIndex.startsWith('final_')) {
                    section = 'final';
                    numericIndex = parseInt(fingerToeIndex.replace('final_', ''));
                }
            } else {
                numericIndex = parseInt(fingerToeIndex);
            }
            
            if (section === 'interim') {
                dataArray = interimFingersToesData;
            } else if (section === 'final') {
                dataArray = finalFingersToesData;
            } else {
                dataArray = fingersToesData; // initial
            }
            
            if (!dataArray[numericIndex]) return;

            var joints = dataArray[numericIndex].joints;
            
            if (checked) {
                // Add joint
                joints.push({ jointType: jointType, range: '' });
            } else {
                // Remove joint
                for (var i = 0; i < joints.length; i++) {
                    if (joints[i].jointType === jointType) {
                        joints.splice(i, 1);
                        break;
                    }
                }
            }

            updateJointRanges(fingerToeIndex, section);
        }

        function updateJointRanges(fingerToeIndex, section) {
            var container = document.getElementById('joint-ranges-' + fingerToeIndex);
            
            var dataArray;
            var numericIndex;
            
            // Parse section from index if not provided
            if (!section && typeof fingerToeIndex === 'string') {
                if (fingerToeIndex.startsWith('initial_')) {
                    section = 'initial';
                    numericIndex = parseInt(fingerToeIndex.replace('initial_', ''));
                } else if (fingerToeIndex.startsWith('interim_')) {
                    section = 'interim';
                    numericIndex = parseInt(fingerToeIndex.replace('interim_', ''));
                } else if (fingerToeIndex.startsWith('final_')) {
                    section = 'final';
                    numericIndex = parseInt(fingerToeIndex.replace('final_', ''));
                }
            } else {
                numericIndex = parseInt(fingerToeIndex);
            }
            
            if (section === 'interim') {
                dataArray = interimFingersToesData;
            } else if (section === 'final') {
                dataArray = finalFingersToesData;
            } else {
                dataArray = fingersToesData; // initial
            }
            
            if (!container || !dataArray[numericIndex]) return;

            var joints = dataArray[numericIndex].joints;
            var locationId = (section === 'interim') ? 'interimLocation' : 
                            (section === 'final') ? 'finalLocation' : 'initialLocation';
            var location = document.getElementById(locationId).value;
            var jointOptions = getSmallJointOptions(location);

            container.innerHTML = '';

            if (joints.length > 0) {
                var headerDiv = document.createElement('div');
                headerDiv.innerHTML = '<label class="form-label">Joint Ranges</label>';
                container.appendChild(headerDiv);

                for (var i = 0; i < joints.length; i++) {
                    var joint = joints[i];
                    var jointOption = null;
                    
                    for (var j = 0; j < jointOptions.length; j++) {
                        if (jointOptions[j].value === joint.jointType) {
                            jointOption = jointOptions[j];
                            break;
                        }
                    }

                    if (jointOption) {
                        var rangeDiv = document.createElement('div');
                        rangeDiv.className = 'joint-range-row';
                        rangeDiv.innerHTML = '<div class="joint-range-label">' + jointOption.label + '</div>' +
                                           '<div class="joint-range-input"><input type="text" class="form-input small-input" placeholder="e.g., 5-70" onchange="updateJointRange(' + fingerToeIndex + ', \'' + joint.jointType + '\', this.value)"></div>';
                        container.appendChild(rangeDiv);
                    }
                }
            }
        }

        function updateJointRange(fingerToeIndex, jointType, range) {
            if (!fingersToesData[fingerToeIndex]) return;

            var joints = fingersToesData[fingerToeIndex].joints;
            for (var i = 0; i < joints.length; i++) {
                if (joints[i].jointType === jointType) {
                    joints[i].range = range;
                    break;
                }
            }
        }

        function removeFingerToe(index) {
            fingersToesData.splice(index, 1);
            
            // Rebuild the entire container
            var container = document.getElementById('initialFingersToesContainer');
            container.innerHTML = '';
            
            // Re-add all remaining fingers/toes
            var tempData = fingersToesData.slice();
            fingersToesData = [];
            
            for (var i = 0; i < tempData.length; i++) {
                addInitialFingerToe();
                fingersToesData[i] = tempData[i];
                
                // Restore name
                var nameInput = container.children[i].querySelector('.finger-toe-name-input');
                if (nameInput) {
                    nameInput.value = tempData[i].name;
                }
                
                // Restore joint selections and ranges
                for (var j = 0; j < tempData[i].joints.length; j++) {
                    var joint = tempData[i].joints[j];
                    var checkbox = document.getElementById('joint_' + i + '_' + joint.jointType);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                }
                
                updateJointRanges(i);
                
                // Restore range values
                for (var j = 0; j < tempData[i].joints.length; j++) {
                    var joint = tempData[i].joints[j];
                    var rangeInputs = container.children[i].querySelectorAll('.joint-range-input input');
                    for (var k = 0; k < rangeInputs.length; k++) {
                        var rangeInput = rangeInputs[k];
                        if (rangeInput.getAttribute('onchange').indexOf(joint.jointType) !== -1) {
                            rangeInput.value = joint.range;
                            break;
                        }
                    }
                }
            }
        }

        function getSmallJointOptions(location) {
            if (location === 'hand') {
                return [
                    { value: 'cmcj', label: 'Carpometacarpal joint (CMCJ)' },
                    { value: 'mcpj', label: 'Metacarpophalengeal joint (MCPJ)' },
                    { value: 'pipj', label: 'Proximal interphalengeal joint (PIPJ)' },
                    { value: 'dipj', label: 'Distal interphalengeal joint (DIPJ)' },
                    { value: 'ipj', label: 'Interphalengeal joint (IPJ)' }
                ];
            } else if (location === 'foot') {
                return [
                    { value: 'mtpj', label: 'Metatarsophalengeal joint (MTPJ)' },
                    { value: 'pipj', label: 'Proximal interphalengeal joint (PIPJ)' },
                    { value: 'dipj', label: 'Distal interphalengeal joint (DIPJ)' },
                    { value: 'ipj', label: 'Interphalengeal joint (IPJ)' }
                ];
            }
            return [];
        }

        // Muscle Power field generation
        function generateInitialMusclePowerFields(location, side) {
            var container = document.getElementById('initialMusclePowerContainer');
            if (!container) return;

            // Skip if back/neck (uses myotome) or hand (uses grip strength)
            if (location === 'back' || location === 'neck' || location === 'hand') {
                container.innerHTML = '';
                return;
            }

            var muscleGroups = getMuscleGroups(location);
            container.innerHTML = '';

            var showBilateral = (side === 'Bilateral' || side === '');
            
            for (var i = 0; i < muscleGroups.length; i++) {
                var muscleDiv = document.createElement('div');
                muscleDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + muscleGroups[i] + '</div>';
                html += '<div class="muscle-input">';
                
                if (showBilateral) {
                    // Show both left and right for bilateral or no side selected
                    html += '<select class="form-select small-input muscle-left" style="margin-right: 10px;">';
                    html += '<option value="">Left</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                    
                    html += '<select class="form-select small-input muscle-right">';
                    html += '<option value="">Right</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                } else {
                    // Show only one side based on selection (opposite side for unilateral)
                    var sideLabel = (side === 'Right') ? 'Left' : 'Right';
                    html += '<select class="form-select medium-input muscle-single">';
                    html += '<option value="">' + sideLabel + ' Grade</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                }
                
                html += '</div>';
                muscleDiv.innerHTML = html;
                container.appendChild(muscleDiv);
            }
        }

        function getMuscleGroups(location) {
            var muscles = {
                'shoulder': ['Flexor', 'Abductor', 'Extensor', 'External Rotator', 'Internal Rotator'],
                'elbow': ['Flexor', 'Extensor', 'Pronator', 'Supinator'],
                'wrist': ['Flexor', 'Extensor', 'Pronator', 'Supinator', 'Radial Deviator', 'Ulnar Deviator'],
                'hip': ['Flexor', 'Extensor', 'Abductor', 'External Rotator', 'Internal Rotator'],
                'knee': ['Flexor', 'Extensor'],
                'ankle': ['Plantarflexor', 'Dorsiflexor', 'Evertor', 'Invertor', 'Toes'],
                'foot': ['Plantarflexor', 'Dorsiflexor', 'Evertor', 'Invertor', 'Toes']
            };
            return muscles[location] || [];
        }

        // Myotome field generation
        function generateInitialMyotomeFields(location) {
            var container = document.getElementById('initialMyotomeContainer');
            if (!container) return;

            var levels = getMyotomeLevels(location);
            container.innerHTML = '';

            for (var i = 0; i < levels.length; i++) {
                var levelDiv = document.createElement('div');
                levelDiv.className = 'grid-3';
                
                var html = '<div class="grid-3-col muscle-label">' + levels[i] + '</div>';
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-left">';
                html += '<option value="">Left</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-right">';
                html += '<option value="">Right</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                levelDiv.innerHTML = html;
                container.appendChild(levelDiv);
            }
        }

        function getMyotomeLevels(location) {
            var levels = {
                'back': ['L2', 'L3', 'L4', 'L5', 'S1'],
                'neck': ['C5', 'C6', 'C7', 'C8', 'T1']
            };
            return levels[location] || [];
        }

        // Questionnaire updates
        function updateInitialQuestionnaires(location) {
            var select = document.getElementById('initialQuestionnaire');
            if (!select) return;

            var questionnaires = getRegionQuestionnaires(location);
            select.innerHTML = '<option value="">Select Questionnaire</option>';
            
            for (var i = 0; i < questionnaires.length; i++) {
                var option = document.createElement('option');
                option.value = questionnaires[i];
                option.textContent = questionnaires[i];
                select.appendChild(option);
            }
        }

        function getRegionQuestionnaires(location) {
            var questionnaires = {
                'shoulder': ['QuickDASH'],
                'elbow': ['QuickDASH'],
                'wrist': ['QuickDASH'],
                'hand': ['QuickDASH'],
                'hip': ['Lower Extremity Functional Scale'],
                'ankle': ['Lower Extremity Functional Scale'],
                'foot': ['Lower Extremity Functional Scale'],
                'neck': ['Northwick Park Neck Pain Questionnaire'],
                'back': ['Roland-Morris Disability Questionnaire'],
                'knee': ['Lower Extremity Functional Scale', 'Knee Injury & Osteoarthritis Outcome Score-Pain', 'Knee Injury & Osteoarthritis Outcome Score-PS', 'Knee Injury & Osteoarthritis Outcome Score-QoL']
            };
            return questionnaires[location] || [];
        }

        // Auto-fill functions
        function autoFillInitialMuscles() {
            var grade = document.getElementById('initialAutoFillGrade').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#initialMusclePowerContainer .muscle-left, #initialMusclePowerContainer .muscle-single');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        function clearInitialMuscles() {
            var selects = document.querySelectorAll('#initialMusclePowerContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = '';
            }
        }

        function autoFillInitialMyotome() {
            var grade = document.getElementById('initialMyotomeAutoFill').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#initialMyotomeContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        // Toggle functions for checkboxes
        function toggleInitialAromPanel() {
            var checkbox = document.getElementById('initialAromNotTested');
            var panel = document.getElementById('initialAromPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInitialHandGripPanel() {
            var checkbox = document.getElementById('initialHandGripNotTested');
            var panel = document.getElementById('initialHandGripPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInitialMusclePowerPanel() {
            var checkbox = document.getElementById('initialMusclePowerNotTested');
            var panel = document.getElementById('initialMusclePowerPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInitialTenderness() {
            var checkbox = document.getElementById('initialTenderness');
            var field = document.getElementById('initialTendernessField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInitialSwelling() {
            var checkbox = document.getElementById('initialSwelling');
            var field = document.getElementById('initialSwellingField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInitialTemperature() {
            var checkbox = document.getElementById('initialTemperature');
            var field = document.getElementById('initialTemperatureField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInitialSensation() {
            var checkbox = document.getElementById('initialSensation');
            var field = document.getElementById('initialSensationField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInitialSensationDetails() {
            var select = document.getElementById('initialSensationStatus');
            var reducedDetails = document.getElementById('initialSensationReducedDetails');
            var hypersensitiveDetails = document.getElementById('initialSensationHypersensitiveDetails');
            
            if (reducedDetails && hypersensitiveDetails) {
                if (select.value === 'reduced') {
                    reducedDetails.classList.remove('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                } else if (select.value === 'hypersensitive') {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.remove('hidden');
                } else {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                }
            }
        }

        function toggleInitialReflex() {
            var checkbox = document.getElementById('initialReflex');
            var field = document.getElementById('initialReflexField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInitialWbStatus() {
            var checkbox = document.getElementById('initialWbStatus');
            var field = document.getElementById('initialWbStatusField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        // Add functions
        function addReferralSource() {
            var container = document.getElementById('referralSources');
            var newSource = document.createElement('div');
            newSource.className = 'referral-source';
            newSource.innerHTML = '<div class="form-row"><div class="form-col"><label class="form-label">Department:</label><input type="text" class="form-input referral-department" placeholder="e.g., Department of Orthopedics and Traumatology"></div><div class="form-col"><label class="form-label">Hospital:</label><input type="text" class="form-input referral-hospital" placeholder="e.g., Tuen Mun Hospital"></div></div>';
            container.appendChild(newSource);
        }

        function addInitialSpecialTest() {
            var container = document.getElementById('initialSpecialTests');
            var testDiv = document.createElement('div');
            testDiv.className = 'grid-2';
            testDiv.innerHTML = '<div class="grid-2-col"><input type="text" class="form-input special-test-name" placeholder="Enter test name"></div><div class="grid-2-col"><select class="form-select special-test-result"><option value="">Select Result</option><option value="positive">Positive</option><option value="negative">Negative</option></select></div>';
            container.appendChild(testDiv);
        }

        // Functional Activity Functions
        var initialActivityCount = 2;
        var interimActivityCount = 2;
        var finalActivityCount = 2;

        function addInitialFunctionalActivity() {
            initialActivityCount++;
            var container = document.getElementById('initialAdditionalActivities');
            var activityDiv = document.createElement('div');
            activityDiv.className = 'form-group';
            activityDiv.innerHTML = '<label class="form-label">Functional Activity ' + initialActivityCount + ':</label>' +
                '<div class="grid-2">' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-activity">' +
                                    '<option value="">Select activity</option>' +
                                    '<option value="reading">Reading</option>' +
                                    '<option value="sitting">Sitting</option>' +
                                    '<option value="walking">Walking</option>' +
                                    '<option value="standing">Standing</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<input type="text" class="form-input functional-duration" placeholder="e.g., 30">' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-unit">' +
                                    '<option value="minutes">Minutes</option>' +
                                    '<option value="hours">Hours</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-aid">' +
                                    '<option value="">Select Aid</option>' +
                                    '<option value="unaided">Unaided</option>' +
                                    '<option value="stick">Stick</option>' +
                                    '<option value="quadruped">Quadruped</option>' +
                                    '<option value="frame">Frame</option>' +
                                    '<option value="elbow crutches">Elbow Crutches</option>' +
                                    '<option value="rollator">Rollator</option>' +
                                '</select>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            container.appendChild(activityDiv);
        }

        function addInterimFunctionalActivity() {
            interimActivityCount++;
            var container = document.getElementById('interimAdditionalActivities');
            var activityDiv = document.createElement('div');
            activityDiv.className = 'form-group';
            activityDiv.innerHTML = '<label class="form-label">Functional Activity ' + interimActivityCount + ':</label>' +
                '<div class="grid-2">' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-activity">' +
                                    '<option value="">Select activity</option>' +
                                    '<option value="reading">Reading</option>' +
                                    '<option value="sitting">Sitting</option>' +
                                    '<option value="walking">Walking</option>' +
                                    '<option value="standing">Standing</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<input type="text" class="form-input functional-duration" placeholder="e.g., 30">' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-unit">' +
                                    '<option value="minutes">Minutes</option>' +
                                    '<option value="hours">Hours</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-aid">' +
                                    '<option value="">Select Aid</option>' +
                                    '<option value="unaided">Unaided</option>' +
                                    '<option value="stick">Stick</option>' +
                                    '<option value="quadruped">Quadruped</option>' +
                                    '<option value="frame">Frame</option>' +
                                    '<option value="elbow crutches">Elbow Crutches</option>' +
                                    '<option value="rollator">Rollator</option>' +
                                '</select>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            container.appendChild(activityDiv);
        }

        function addFinalFunctionalActivity() {
            finalActivityCount++;
            var container = document.getElementById('finalAdditionalActivities');
            var activityDiv = document.createElement('div');
            activityDiv.className = 'form-group';
            activityDiv.innerHTML = '<label class="form-label">Functional Activity ' + finalActivityCount + ':</label>' +
                '<div class="grid-2">' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-activity">' +
                                    '<option value="">Select activity</option>' +
                                    '<option value="reading">Reading</option>' +
                                    '<option value="sitting">Sitting</option>' +
                                    '<option value="walking">Walking</option>' +
                                    '<option value="standing">Standing</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<input type="text" class="form-input functional-duration" placeholder="e.g., 30">' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="grid-2-col">' +
                        '<div class="grid-2">' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-unit">' +
                                    '<option value="minutes">Minutes</option>' +
                                    '<option value="hours">Hours</option>' +
                                '</select>' +
                            '</div>' +
                            '<div class="grid-2-col">' +
                                '<select class="form-select functional-aid">' +
                                    '<option value="">Select Aid</option>' +
                                    '<option value="unaided">Unaided</option>' +
                                    '<option value="stick">Stick</option>' +
                                    '<option value="quadruped">Quadruped</option>' +
                                    '<option value="frame">Frame</option>' +
                                    '<option value="elbow crutches">Elbow Crutches</option>' +
                                    '<option value="rollator">Rollator</option>' +
                                '</select>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            container.appendChild(activityDiv);
        }

        // INTERIM SECTION FUNCTIONS
        // Region-specific field updates for interim
        function updateInterimRegionFields() {
            var location = document.getElementById('interimLocation').value;
            var side = document.getElementById('interimSide').value;
            
            // Show/hide toes ROM for ankle
            var toesRomSection = document.getElementById('interimToesRomSection');
            if (toesRomSection) {
                if (location === 'ankle') {
                    toesRomSection.style.display = 'block';
                } else {
                    toesRomSection.style.display = 'none';
                }
            }

            // Show/hide fingers/toes ROM for hand/foot
            var fingersToesSection = document.getElementById('interimFingersToesSection');
            var fingersToesHeader = document.getElementById('interimFingersToesHeader');
            if (fingersToesSection && fingersToesHeader) {
                if (location === 'hand' || location === 'foot') {
                    fingersToesSection.style.display = 'block';
                    fingersToesHeader.textContent = (location === 'hand' ? 'Fingers' : 'Toes') + ' Range of Motion';
                    var addButton = fingersToesSection.querySelector('button');
                    if (addButton) {
                        addButton.textContent = 'Add ' + (location === 'hand' ? 'Finger' : 'Toe');
                    }
                } else {
                    fingersToesSection.style.display = 'none';
                }
            }

            // Show/hide hand grip for hand
            var handGripGroup = document.getElementById('interimHandGripGroup');
            if (handGripGroup) {
                if (location === 'hand') {
                    handGripGroup.style.display = 'block';
                } else {
                    handGripGroup.style.display = 'none';
                }
            }

            // Show/hide myotome for back/neck
            var myotomeGroup = document.getElementById('interimMyotomeGroup');
            if (myotomeGroup) {
                if (location === 'back' || location === 'neck') {
                    myotomeGroup.style.display = 'block';
                    generateInterimMyotomeFields(location);
                } else {
                    myotomeGroup.style.display = 'none';
                }
            }

            // Update muscle power label and auto-fill section
            var musclePowerLabel = document.getElementById('interimMusclePowerLabel');
            var autoFillLabel = document.getElementById('interimAutoFillLabel');
            var autoFillSection = document.getElementById('interimAutoFillSection');
            
            if (location === 'back' || location === 'neck') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Myotome Testing:';
                if (autoFillLabel) autoFillLabel.textContent = 'Auto-fill all levels';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else if (location === 'hand') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Hand Grip Strength Testing:';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Muscle Power (Oxford Manual Muscle Testing Scale):';
                if (autoFillLabel) autoFillLabel.textContent = 'Apply to all muscle groups';
                if (autoFillSection) autoFillSection.style.display = 'block';
            }

            // Update AROM movements
            generateInterimAromFields();

            // Update muscle power groups
            generateInterimMusclePowerFields(location, side);

            // Update questionnaires
            updateInterimQuestionnaires(location);
        }
        
        // Expose interim function to global scope
        window.updateInterimRegionFields = updateInterimRegionFields;

        // AROM field generation for interim
        function generateInterimAromFields() {
            var location = document.getElementById('interimLocation').value;
            var container = document.getElementById('interimAromMovements');
            if (!container) return;

            var movements = getAromMovements(location);
            container.innerHTML = '';

            if (movements.length === 0) return;

            var includeProm = document.getElementById('interimIncludeProm').checked;
            var isBackNeck = (location === 'back' || location === 'neck');
            
            for (var i = 0; i < movements.length; i++) {
                var movementDiv = document.createElement('div');
                movementDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + movements[i] + '</div>';
                html += '<div class="muscle-input">';
                html += '<input type="text" class="form-input small-input arom-value" placeholder="' + 
                        (isBackNeck ? 'e.g., 3/5' : 'e.g., 90') + '">';
                
                if (includeProm) {
                    html += '<input type="text" class="form-input small-input prom-value" placeholder="' + 
                            (isBackNeck ? 'e.g., 4/5' : 'e.g., 95') + '" style="margin-left: 10px;">';
                }
                
                html += '</div>';
                movementDiv.innerHTML = html;
                container.appendChild(movementDiv);
            }
        }

        // Muscle Power field generation for interim
        function generateInterimMusclePowerFields(location, side) {
            var container = document.getElementById('interimMusclePowerContainer');
            if (!container) return;

            // Skip if back/neck (uses myotome) or hand (uses grip strength)
            if (location === 'back' || location === 'neck' || location === 'hand') {
                container.innerHTML = '';
                return;
            }

            var muscleGroups = getMuscleGroups(location);
            container.innerHTML = '';

            var showBilateral = (side === 'Bilateral' || side === '');
            
            for (var i = 0; i < muscleGroups.length; i++) {
                var muscleDiv = document.createElement('div');
                muscleDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + muscleGroups[i] + '</div>';
                html += '<div class="muscle-input">';
                
                if (showBilateral) {
                    html += '<select class="form-select small-input muscle-left" style="margin-right: 10px;">';
                    html += '<option value="">Left</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                    
                    html += '<select class="form-select small-input muscle-right">';
                    html += '<option value="">Right</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                } else {
                    var sideLabel = (side === 'Right') ? 'Left' : 'Right';
                    html += '<select class="form-select medium-input muscle-single">';
                    html += '<option value="">' + sideLabel + ' Grade</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                }
                
                html += '</div>';
                muscleDiv.innerHTML = html;
                container.appendChild(muscleDiv);
            }
        }

        // Myotome field generation for interim
        function generateInterimMyotomeFields(location) {
            var container = document.getElementById('interimMyotomeContainer');
            if (!container) return;

            var levels = getMyotomeLevels(location);
            container.innerHTML = '';

            for (var i = 0; i < levels.length; i++) {
                var levelDiv = document.createElement('div');
                levelDiv.className = 'grid-3';
                
                var html = '<div class="grid-3-col muscle-label">' + levels[i] + '</div>';
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-left">';
                html += '<option value="">Left</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-right">';
                html += '<option value="">Right</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                levelDiv.innerHTML = html;
                container.appendChild(levelDiv);
            }
        }

        // Questionnaire updates for interim
        function updateInterimQuestionnaires(location) {
            var select = document.getElementById('interimQuestionnaire');
            if (!select) return;

            var questionnaires = getRegionQuestionnaires(location);
            select.innerHTML = '<option value="">Select Questionnaire</option>';
            
            for (var i = 0; i < questionnaires.length; i++) {
                var option = document.createElement('option');
                option.value = questionnaires[i];
                option.textContent = questionnaires[i];
                select.appendChild(option);
            }
        }

        // Auto-fill functions for interim
        function autoFillInterimMuscles() {
            var grade = document.getElementById('interimAutoFillGrade').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#interimMusclePowerContainer .muscle-left, #interimMusclePowerContainer .muscle-single');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        function clearInterimMuscles() {
            var selects = document.querySelectorAll('#interimMusclePowerContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = '';
            }
        }

        function autoFillInterimMyotome() {
            var grade = document.getElementById('interimMyotomeAutoFill').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#interimMyotomeContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        // Toggle functions for interim checkboxes
        function toggleInterimAromPanel() {
            var checkbox = document.getElementById('interimAromNotTested');
            var panel = document.getElementById('interimAromPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInterimHandGripPanel() {
            var checkbox = document.getElementById('interimHandGripNotTested');
            var panel = document.getElementById('interimHandGripPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInterimMusclePowerPanel() {
            var checkbox = document.getElementById('interimMusclePowerNotTested');
            var panel = document.getElementById('interimMusclePowerPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleInterimTenderness() {
            var checkbox = document.getElementById('interimTenderness');
            var field = document.getElementById('interimTendernessField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInterimSwelling() {
            var checkbox = document.getElementById('interimSwelling');
            var field = document.getElementById('interimSwellingField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInterimTemperature() {
            var checkbox = document.getElementById('interimTemperature');
            var field = document.getElementById('interimTemperatureField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInterimSensation() {
            var checkbox = document.getElementById('interimSensation');
            var field = document.getElementById('interimSensationField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInterimSensationDetails() {
            var select = document.getElementById('interimSensationStatus');
            var reducedDetails = document.getElementById('interimSensationReducedDetails');
            var hypersensitiveDetails = document.getElementById('interimSensationHypersensitiveDetails');
            
            if (reducedDetails && hypersensitiveDetails) {
                if (select.value === 'reduced') {
                    reducedDetails.classList.remove('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                } else if (select.value === 'hypersensitive') {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.remove('hidden');
                } else {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                }
            }
        }

        function toggleInterimReflex() {
            var checkbox = document.getElementById('interimReflex');
            var field = document.getElementById('interimReflexField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleInterimWbStatus() {
            var checkbox = document.getElementById('interimWbStatus');
            var field = document.getElementById('interimWbStatusField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        // Add functions for interim
        function addInterimFingerToe() {
            // Use the same logic as initial but with interim IDs
            addInitialFingerToe(); // This function can be reused with proper ID handling
        }

        function addInterimSpecialTest() {
            var container = document.getElementById('interimSpecialTests');
            var testDiv = document.createElement('div');
            testDiv.className = 'grid-2';
            testDiv.innerHTML = '<div class="grid-2-col"><input type="text" class="form-input special-test-name" placeholder="Enter test name"></div><div class="grid-2-col"><select class="form-select special-test-result"><option value="">Select Result</option><option value="positive">Positive</option><option value="negative">Negative</option></select></div>';
            container.appendChild(testDiv);
        }

        // FINAL SECTION FUNCTIONS - Similar to interim but with final IDs
        function updateFinalRegionFields() {
            var location = document.getElementById('finalLocation').value;
            var side = document.getElementById('finalSide').value;
            
            // Show/hide toes ROM for ankle
            var toesRomSection = document.getElementById('finalToesRomSection');
            if (toesRomSection) {
                if (location === 'ankle') {
                    toesRomSection.style.display = 'block';
                } else {
                    toesRomSection.style.display = 'none';
                }
            }

            // Show/hide fingers/toes ROM for hand/foot
            var fingersToesSection = document.getElementById('finalFingersToesSection');
            var fingersToesHeader = document.getElementById('finalFingersToesHeader');
            if (fingersToesSection && fingersToesHeader) {
                if (location === 'hand' || location === 'foot') {
                    fingersToesSection.style.display = 'block';
                    fingersToesHeader.textContent = (location === 'hand' ? 'Fingers' : 'Toes') + ' Range of Motion';
                    var addButton = fingersToesSection.querySelector('button');
                    if (addButton) {
                        addButton.textContent = 'Add ' + (location === 'hand' ? 'Finger' : 'Toe');
                    }
                } else {
                    fingersToesSection.style.display = 'none';
                }
            }

            // Show/hide hand grip for hand
            var handGripGroup = document.getElementById('finalHandGripGroup');
            if (handGripGroup) {
                if (location === 'hand') {
                    handGripGroup.style.display = 'block';
                } else {
                    handGripGroup.style.display = 'none';
                }
            }

            // Show/hide myotome for back/neck
            var myotomeGroup = document.getElementById('finalMyotomeGroup');
            if (myotomeGroup) {
                if (location === 'back' || location === 'neck') {
                    myotomeGroup.style.display = 'block';
                    generateFinalMyotomeFields(location);
                } else {
                    myotomeGroup.style.display = 'none';
                }
            }

            // Update muscle power label and auto-fill section
            var musclePowerLabel = document.getElementById('finalMusclePowerLabel');
            var autoFillLabel = document.getElementById('finalAutoFillLabel');
            var autoFillSection = document.getElementById('finalAutoFillSection');
            
            if (location === 'back' || location === 'neck') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Myotome Testing:';
                if (autoFillLabel) autoFillLabel.textContent = 'Auto-fill all levels';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else if (location === 'hand') {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Hand Grip Strength Testing:';
                if (autoFillSection) autoFillSection.style.display = 'none';
            } else {
                if (musclePowerLabel) musclePowerLabel.textContent = 'Muscle Power (Oxford Manual Muscle Testing Scale):';
                if (autoFillLabel) autoFillLabel.textContent = 'Apply to all muscle groups';
                if (autoFillSection) autoFillSection.style.display = 'block';
            }

            // Update AROM movements
            generateFinalAromFields();

            // Update muscle power groups
            generateFinalMusclePowerFields(location, side);

            // Update questionnaires
            updateFinalQuestionnaires(location);
        }
        
        // Expose final function to global scope
        window.updateFinalRegionFields = updateFinalRegionFields;

        // AROM field generation for final
        function generateFinalAromFields() {
            var location = document.getElementById('finalLocation').value;
            var container = document.getElementById('finalAromMovements');
            if (!container) return;

            var movements = getAromMovements(location);
            container.innerHTML = '';

            if (movements.length === 0) return;

            var includeProm = document.getElementById('finalIncludeProm').checked;
            var isBackNeck = (location === 'back' || location === 'neck');
            
            for (var i = 0; i < movements.length; i++) {
                var movementDiv = document.createElement('div');
                movementDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + movements[i] + '</div>';
                html += '<div class="muscle-input">';
                html += '<input type="text" class="form-input small-input arom-value" placeholder="' + 
                        (isBackNeck ? 'e.g., 3/5' : 'e.g., 90') + '">';
                
                if (includeProm) {
                    html += '<input type="text" class="form-input small-input prom-value" placeholder="' + 
                            (isBackNeck ? 'e.g., 4/5' : 'e.g., 95') + '" style="margin-left: 10px;">';
                }
                
                html += '</div>';
                movementDiv.innerHTML = html;
                container.appendChild(movementDiv);
            }
        }

        // Muscle Power field generation for final
        function generateFinalMusclePowerFields(location, side) {
            var container = document.getElementById('finalMusclePowerContainer');
            if (!container) return;

            // Skip if back/neck (uses myotome) or hand (uses grip strength)
            if (location === 'back' || location === 'neck' || location === 'hand') {
                container.innerHTML = '';
                return;
            }

            var muscleGroups = getMuscleGroups(location);
            container.innerHTML = '';

            var showBilateral = (side === 'Bilateral' || side === '');
            
            for (var i = 0; i < muscleGroups.length; i++) {
                var muscleDiv = document.createElement('div');
                muscleDiv.className = 'muscle-row';
                
                var html = '<div class="muscle-label">' + muscleGroups[i] + '</div>';
                html += '<div class="muscle-input">';
                
                if (showBilateral) {
                    html += '<select class="form-select small-input muscle-left" style="margin-right: 10px;">';
                    html += '<option value="">Left</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                    
                    html += '<select class="form-select small-input muscle-right">';
                    html += '<option value="">Right</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                } else {
                    var sideLabel = (side === 'Right') ? 'Left' : 'Right';
                    html += '<select class="form-select medium-input muscle-single">';
                    html += '<option value="">' + sideLabel + ' Grade</option>';
                    html += '<option value="0">0 out of 5</option>';
                    html += '<option value="1">1 out of 5</option>';
                    html += '<option value="2">2 out of 5</option>';
                    html += '<option value="3">3 out of 5</option>';
                    html += '<option value="4">4 out of 5</option>';
                    html += '<option value="5">5 out of 5</option>';
                    html += '</select>';
                }
                
                html += '</div>';
                muscleDiv.innerHTML = html;
                container.appendChild(muscleDiv);
            }
        }

        // Myotome field generation for final
        function generateFinalMyotomeFields(location) {
            var container = document.getElementById('finalMyotomeContainer');
            if (!container) return;

            var levels = getMyotomeLevels(location);
            container.innerHTML = '';

            for (var i = 0; i < levels.length; i++) {
                var levelDiv = document.createElement('div');
                levelDiv.className = 'grid-3';
                
                var html = '<div class="grid-3-col muscle-label">' + levels[i] + '</div>';
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-left">';
                html += '<option value="">Left</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                html += '<div class="grid-3-col">';
                html += '<select class="form-select myotome-right">';
                html += '<option value="">Right</option>';
                html += '<option value="0">0/5</option>';
                html += '<option value="1">1/5</option>';
                html += '<option value="2">2/5</option>';
                html += '<option value="3">3/5</option>';
                html += '<option value="4">4/5</option>';
                html += '<option value="5">5/5</option>';
                html += '</select></div>';
                
                levelDiv.innerHTML = html;
                container.appendChild(levelDiv);
            }
        }

        // Questionnaire updates for final
        function updateFinalQuestionnaires(location) {
            var select = document.getElementById('finalQuestionnaire');
            if (!select) return;

            var questionnaires = getRegionQuestionnaires(location);
            select.innerHTML = '<option value="">Select Questionnaire</option>';
            
            for (var i = 0; i < questionnaires.length; i++) {
                var option = document.createElement('option');
                option.value = questionnaires[i];
                option.textContent = questionnaires[i];
                select.appendChild(option);
            }
        }

        // Auto-fill functions for final
        function autoFillFinalMuscles() {
            var grade = document.getElementById('finalAutoFillGrade').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#finalMusclePowerContainer .muscle-left, #finalMusclePowerContainer .muscle-single');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        function clearFinalMuscles() {
            var selects = document.querySelectorAll('#finalMusclePowerContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = '';
            }
        }

        function autoFillFinalMyotome() {
            var grade = document.getElementById('finalMyotomeAutoFill').value;
            if (!grade) return;

            var selects = document.querySelectorAll('#finalMyotomeContainer select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].value = grade;
            }
        }

        // Toggle functions for final checkboxes
        function toggleFinalAromPanel() {
            var checkbox = document.getElementById('finalAromNotTested');
            var panel = document.getElementById('finalAromPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleFinalHandGripPanel() {
            var checkbox = document.getElementById('finalHandGripNotTested');
            var panel = document.getElementById('finalHandGripPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleFinalMusclePowerPanel() {
            var checkbox = document.getElementById('finalMusclePowerNotTested');
            var panel = document.getElementById('finalMusclePowerPanel');
            if (panel) {
                panel.style.display = checkbox.checked ? 'none' : 'block';
            }
        }

        function toggleFinalTenderness() {
            var checkbox = document.getElementById('finalTenderness');
            var field = document.getElementById('finalTendernessField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleFinalSwelling() {
            var checkbox = document.getElementById('finalSwelling');
            var field = document.getElementById('finalSwellingField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleFinalTemperature() {
            var checkbox = document.getElementById('finalTemperature');
            var field = document.getElementById('finalTemperatureField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleFinalSensation() {
            var checkbox = document.getElementById('finalSensation');
            var field = document.getElementById('finalSensationField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleFinalSensationDetails() {
            var select = document.getElementById('finalSensationStatus');
            var reducedDetails = document.getElementById('finalSensationReducedDetails');
            var hypersensitiveDetails = document.getElementById('finalSensationHypersensitiveDetails');
            
            if (reducedDetails && hypersensitiveDetails) {
                if (select.value === 'reduced') {
                    reducedDetails.classList.remove('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                } else if (select.value === 'hypersensitive') {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.remove('hidden');
                } else {
                    reducedDetails.classList.add('hidden');
                    hypersensitiveDetails.classList.add('hidden');
                }
            }
        }

        function toggleFinalReflex() {
            var checkbox = document.getElementById('finalReflex');
            var field = document.getElementById('finalReflexField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        function toggleFinalWbStatus() {
            var checkbox = document.getElementById('finalWbStatus');
            var field = document.getElementById('finalWbStatusField');
            if (field) {
                if (checkbox.checked) {
                    field.classList.remove('hidden');
                } else {
                    field.classList.add('hidden');
                }
            }
        }

        // Add functions for final
        function addFinalFingerToe() {
            // Use the same logic as initial but with final IDs
            addInitialFingerToe(); // This function can be reused with proper ID handling
        }

        function addFinalSpecialTest() {
            var container = document.getElementById('finalSpecialTests');
            var testDiv = document.createElement('div');
            testDiv.className = 'grid-2';
            testDiv.innerHTML = '<div class="grid-2-col"><input type="text" class="form-input special-test-name" placeholder="Enter test name"></div><div class="grid-2-col"><select class="form-select special-test-result"><option value="">Select Result</option><option value="positive">Positive</option><option value="negative">Negative</option></select></div>';
            container.appendChild(testDiv);
        }

        function copyFromInitialToInterim() {
            // Copy basic patient complaint data
            document.getElementById('interimDate').value = document.getElementById('initialDate').value;
            document.getElementById('interimSide').value = document.getElementById('initialSide').value;
            document.getElementById('interimLocation').value = document.getElementById('initialLocation').value;
            document.getElementById('interimPainIntensity').value = document.getElementById('initialPainIntensity').value;
            document.getElementById('interimOtherSymptoms').value = document.getElementById('initialOtherSymptoms').value;
            document.getElementById('interimSymptomsIntensity').value = document.getElementById('initialSymptomsIntensity').value;
            document.getElementById('interimActivity1').value = document.getElementById('initialActivity1').value;
            document.getElementById('interimActivity1Duration').value = document.getElementById('initialActivity1Duration').value;
            document.getElementById('interimActivity1Unit').value = document.getElementById('initialActivity1Unit').value;
            document.getElementById('interimActivity2').value = document.getElementById('initialActivity2').value;
            document.getElementById('interimActivity2Duration').value = document.getElementById('initialActivity2Duration').value;
            document.getElementById('interimActivity2Unit').value = document.getElementById('initialActivity2Unit').value;
            document.getElementById('interimActivity2Aid').value = document.getElementById('initialActivity2Aid').value;
            document.getElementById('interimOtherFunctionalActivities').value = document.getElementById('initialOtherFunctionalActivities').value;
            document.getElementById('interimOverallImprovement').value = document.getElementById('initialOverallImprovement').value;
            
            // Trigger region field updates for interim FIRST
            updateInterimRegionFields();
            
            // Copy objective findings data AFTER fields are generated
            setTimeout(function() {
                copyObjectiveFindings('initial', 'interim');
            }, 100);
            
            // Copy additional functional activities
            copyAdditionalActivities('initial', 'interim');
        }

        // Enhanced Copy functions - Copy ALL data including dynamic fields
        function copyToInterim() {
            copyFromInitialToInterim();
        }

        function copyToFinal() {
            copyFromInitialToFinal();
        }

        function copyFromInitialToFinal() {
            // Copy basic patient complaint data
            document.getElementById('finalDate').value = document.getElementById('initialDate').value;
            document.getElementById('finalSide').value = document.getElementById('initialSide').value;
            document.getElementById('finalLocation').value = document.getElementById('initialLocation').value;
            document.getElementById('finalPainIntensity').value = document.getElementById('initialPainIntensity').value;
            document.getElementById('finalOtherSymptoms').value = document.getElementById('initialOtherSymptoms').value;
            document.getElementById('finalSymptomsIntensity').value = document.getElementById('initialSymptomsIntensity').value;
            document.getElementById('finalActivity1').value = document.getElementById('initialActivity1').value;
            document.getElementById('finalActivity1Duration').value = document.getElementById('initialActivity1Duration').value;
            document.getElementById('finalActivity1Unit').value = document.getElementById('initialActivity1Unit').value;
            document.getElementById('finalActivity2').value = document.getElementById('initialActivity2').value;
            document.getElementById('finalActivity2Duration').value = document.getElementById('initialActivity2Duration').value;
            document.getElementById('finalActivity2Unit').value = document.getElementById('initialActivity2Unit').value;
            document.getElementById('finalActivity2Aid').value = document.getElementById('initialActivity2Aid').value;
            document.getElementById('finalOtherFunctionalActivities').value = document.getElementById('initialOtherFunctionalActivities').value;
            document.getElementById('finalOverallImprovement').value = document.getElementById('initialOverallImprovement').value;
            
            // Trigger region field updates for final FIRST
            updateFinalRegionFields();
            
            // Copy objective findings data AFTER fields are generated
            setTimeout(function() {
                copyObjectiveFindings('initial', 'final');
            }, 100);
            
            // Copy additional functional activities
            copyAdditionalActivities('initial', 'final');
        }

        function copyFromInterimToFinal() {
            // Copy basic patient complaint data
            document.getElementById('finalDate').value = document.getElementById('interimDate').value;
            document.getElementById('finalSide').value = document.getElementById('interimSide').value;
            document.getElementById('finalLocation').value = document.getElementById('interimLocation').value;
            document.getElementById('finalPainIntensity').value = document.getElementById('interimPainIntensity').value;
            document.getElementById('finalOtherSymptoms').value = document.getElementById('interimOtherSymptoms').value;
            document.getElementById('finalSymptomsIntensity').value = document.getElementById('interimSymptomsIntensity').value;
            document.getElementById('finalActivity1').value = document.getElementById('interimActivity1').value;
            document.getElementById('finalActivity1Duration').value = document.getElementById('interimActivity1Duration').value;
            document.getElementById('finalActivity1Unit').value = document.getElementById('interimActivity1Unit').value;
            document.getElementById('finalActivity2').value = document.getElementById('interimActivity2').value;
            document.getElementById('finalActivity2Duration').value = document.getElementById('interimActivity2Duration').value;
            document.getElementById('finalActivity2Unit').value = document.getElementById('interimActivity2Unit').value;
            document.getElementById('finalActivity2Aid').value = document.getElementById('interimActivity2Aid').value;
            document.getElementById('finalOtherFunctionalActivities').value = document.getElementById('interimOtherFunctionalActivities').value;
            document.getElementById('finalOverallImprovement').value = document.getElementById('interimOverallImprovement').value;
            
            // Trigger region field updates for final FIRST
            updateFinalRegionFields();
            
            // Copy objective findings data AFTER fields are generated
            setTimeout(function() {
                copyObjectiveFindings('interim', 'final');
            }, 100);
            
            // Copy additional functional activities
            copyAdditionalActivities('interim', 'final');
        }

        // Helper function to copy objective findings between sections
        function copyObjectiveFindings(fromPrefix, toPrefix) {
            // Copy PROM checkbox first
            var fromPromCheckbox = document.getElementById(fromPrefix + 'IncludeProm');
            var toPromCheckbox = document.getElementById(toPrefix + 'IncludeProm');
            if (fromPromCheckbox && toPromCheckbox) {
                toPromCheckbox.checked = fromPromCheckbox.checked;
                // Regenerate AROM fields with PROM setting
                if (toPrefix === 'interim') {
                    generateInterimAromFields();
                } else if (toPrefix === 'final') {
                    generateFinalAromFields();
                }
            }
            
            // Copy "Not tested" checkboxes
            var notTestedCheckboxes = ['AromNotTested', 'HandGripNotTested', 'MusclePowerNotTested'];
            for (var i = 0; i < notTestedCheckboxes.length; i++) {
                var fromCheckbox = document.getElementById(fromPrefix + notTestedCheckboxes[i]);
                var toCheckbox = document.getElementById(toPrefix + notTestedCheckboxes[i]);
                if (fromCheckbox && toCheckbox) {
                    toCheckbox.checked = fromCheckbox.checked;
                    // Trigger toggle functions
                    if (toPrefix === 'interim') {
                        if (notTestedCheckboxes[i] === 'AromNotTested') toggleInterimAromPanel();
                        else if (notTestedCheckboxes[i] === 'HandGripNotTested') toggleInterimHandGripPanel();
                        else if (notTestedCheckboxes[i] === 'MusclePowerNotTested') toggleInterimMusclePowerPanel();
                    } else if (toPrefix === 'final') {
                        if (notTestedCheckboxes[i] === 'AromNotTested') toggleFinalAromPanel();
                        else if (notTestedCheckboxes[i] === 'HandGripNotTested') toggleFinalHandGripPanel();
                        else if (notTestedCheckboxes[i] === 'MusclePowerNotTested') toggleFinalMusclePowerPanel();
                    }
                }
            }
            
            // Copy AROM data
            var fromAromInputs = document.querySelectorAll('#' + fromPrefix + 'AromMovements input');
            var toAromInputs = document.querySelectorAll('#' + toPrefix + 'AromMovements input');
            for (var i = 0; i < fromAromInputs.length && i < toAromInputs.length; i++) {
                toAromInputs[i].value = fromAromInputs[i].value;
            }
            
            // Copy muscle power data
            var fromMuscleSelects = document.querySelectorAll('#' + fromPrefix + 'MusclePowerContainer select');
            var toMuscleSelects = document.querySelectorAll('#' + toPrefix + 'MusclePowerContainer select');
            for (var i = 0; i < fromMuscleSelects.length && i < toMuscleSelects.length; i++) {
                toMuscleSelects[i].value = fromMuscleSelects[i].value;
            }
            
            // Copy myotome data
            var fromMyotomeSelects = document.querySelectorAll('#' + fromPrefix + 'MyotomeContainer select');
            var toMyotomeSelects = document.querySelectorAll('#' + toPrefix + 'MyotomeContainer select');
            for (var i = 0; i < fromMyotomeSelects.length && i < toMyotomeSelects.length; i++) {
                toMyotomeSelects[i].value = fromMyotomeSelects[i].value;
            }
            
            // Copy hand grip data
            var handGripFields = ['LeftHandGrip', 'RightHandGrip', 'LeftPinchGrip', 'RightPinchGrip', 'LeftLateralPinch', 'RightLateralPinch'];
            for (var i = 0; i < handGripFields.length; i++) {
                var fromField = document.getElementById(fromPrefix + handGripFields[i]);
                var toField = document.getElementById(toPrefix + handGripFields[i]);
                if (fromField && toField) {
                    toField.value = fromField.value;
                }
            }
            
            // Copy toes ROM
            var fromToesRom = document.getElementById(fromPrefix + 'ToesROM');
            var toToesRom = document.getElementById(toPrefix + 'ToesROM');
            if (fromToesRom && toToesRom) {
                toToesRom.value = fromToesRom.value;
            }
            
            // Copy assessment checkboxes and fields
            var assessmentFields = ['Tenderness', 'Swelling', 'Temperature', 'Sensation', 'Reflex', 'WbStatus'];
            for (var i = 0; i < assessmentFields.length; i++) {
                var fromCheckbox = document.getElementById(fromPrefix + assessmentFields[i]);
                var toCheckbox = document.getElementById(toPrefix + assessmentFields[i]);
                if (fromCheckbox && toCheckbox) {
                    toCheckbox.checked = fromCheckbox.checked;
                    // Trigger the toggle function
                    if (toPrefix === 'interim') {
                        window['toggleInterim' + assessmentFields[i]]();
                    } else if (toPrefix === 'final') {
                        window['toggleFinal' + assessmentFields[i]]();
                    }
                }
            }
            
            // Copy assessment field values
            var assessmentValueFields = [
                'TendernessArea', 'SensationStatus', 'SensationReduction', 'AreaReduced', 'AreaHypersensitive',
                'WalkingAid', 'WalkingStability', 'WbStatusValue', 'QuestionnaireScore'
            ];
            for (var i = 0; i < assessmentValueFields.length; i++) {
                var fromField = document.getElementById(fromPrefix + assessmentValueFields[i]);
                var toField = document.getElementById(toPrefix + assessmentValueFields[i]);
                if (fromField && toField) {
                    toField.value = fromField.value;
                }
            }
            
            // Copy radio button selections
            var radioGroups = [
                fromPrefix + 'SwellingPresent', fromPrefix + 'TemperatureIncreased', fromPrefix + 'ReflexStatus'
            ];
            for (var i = 0; i < radioGroups.length; i++) {
                var fromRadios = document.querySelectorAll('input[name="' + radioGroups[i] + '"]');
                var toGroupName = radioGroups[i].replace(fromPrefix, toPrefix);
                var toRadios = document.querySelectorAll('input[name="' + toGroupName + '"]');
                
                for (var j = 0; j < fromRadios.length && j < toRadios.length; j++) {
                    if (fromRadios[j].checked) {
                        toRadios[j].checked = true;
                    }
                }
            }
            
            // Copy fingers/toes ROM data
            var fromFingersToesInputs = document.querySelectorAll('#' + fromPrefix + 'FingersToesContainer input, #' + fromPrefix + 'FingersToesContainer select');
            var toFingersToesContainer = document.getElementById(toPrefix + 'FingersToesContainer');
            if (toFingersToesContainer && fromFingersToesInputs.length > 0) {
                // Clear existing fingers/toes
                toFingersToesContainer.innerHTML = '';
                
                // Copy all fingers/toes data by recreating the structure
                var fromFingerToePanels = document.querySelectorAll('#' + fromPrefix + 'FingersToesContainer .finger-toe-panel');
                for (var i = 0; i < fromFingerToePanels.length; i++) {
                    // Add new finger/toe
                    if (toPrefix === 'interim') {
                        addInterimFingerToe();
                    } else if (toPrefix === 'final') {
                        addFinalFingerToe();
                    }
                    
                    // Copy the data from the panel
                    var fromInputs = fromFingerToePanels[i].querySelectorAll('input, select');
                    var toPanels = toFingersToesContainer.querySelectorAll('.finger-toe-panel');
                    if (toPanels[i]) {
                        var toInputs = toPanels[i].querySelectorAll('input, select');
                        for (var j = 0; j < fromInputs.length && j < toInputs.length; j++) {
                            if (fromInputs[j].type === 'checkbox') {
                                toInputs[j].checked = fromInputs[j].checked;
                            } else {
                                toInputs[j].value = fromInputs[j].value;
                            }
                        }
                    }
                }
            }
            
            // Copy special tests
            var fromSpecialTests = document.querySelectorAll('#' + fromPrefix + 'SpecialTests .grid-2');
            var toSpecialTestsContainer = document.getElementById(toPrefix + 'SpecialTests');
            if (toSpecialTestsContainer && fromSpecialTests.length > 0) {
                // Clear existing tests (keep the first one)
                var existingTests = toSpecialTestsContainer.querySelectorAll('.grid-2');
                for (var i = 1; i < existingTests.length; i++) {
                    existingTests[i].remove();
                }
                
                // Copy all tests
                for (var i = 0; i < fromSpecialTests.length; i++) {
                    var fromInputs = fromSpecialTests[i].querySelectorAll('input, select');
                    var toTest;
                    
                    if (i === 0) {
                        // Use existing first test
                        toTest = toSpecialTestsContainer.querySelector('.grid-2');
                    } else {
                        // Add new test
                        if (toPrefix === 'interim') {
                            addInterimSpecialTest();
                        } else if (toPrefix === 'final') {
                            addFinalSpecialTest();
                        }
                        var allToTests = toSpecialTestsContainer.querySelectorAll('.grid-2');
                        toTest = allToTests[allToTests.length - 1];
                    }
                    
                    if (toTest) {
                        var toInputs = toTest.querySelectorAll('input, select');
                        for (var j = 0; j < fromInputs.length && j < toInputs.length; j++) {
                            toInputs[j].value = fromInputs[j].value;
                        }
                    }
                }
            }
        }
        
        // Helper function to copy additional functional activities
        function copyAdditionalActivities(fromPrefix, toPrefix) {
            var fromContainer = document.getElementById(fromPrefix + 'AdditionalActivities');
            var toContainer = document.getElementById(toPrefix + 'AdditionalActivities');
            
            if (fromContainer && toContainer) {
                // Clear existing additional activities
                toContainer.innerHTML = '';
                
                // Copy all additional activities
                var fromActivities = fromContainer.querySelectorAll('.form-group');
                for (var i = 0; i < fromActivities.length; i++) {
                    var clonedActivity = fromActivities[i].cloneNode(true);
                    toContainer.appendChild(clonedActivity);
                }
                
                // Update activity counter
                if (toPrefix === 'interim') {
                    interimActivityCount = 2 + fromActivities.length;
                } else if (toPrefix === 'final') {
                    finalActivityCount = 2 + fromActivities.length;
                }
            }
        }

        // Section 8: Discharge Summary dynamic fields
        function updateDischargeFields() {
            var dischargeType = document.getElementById('dischargeType').value;
            
            // Hide all groups first
            document.getElementById('dischargeDateGroup').style.display = 'none';
            document.getElementById('defaultDateGroup').style.display = 'none';
            document.getElementById('cancellationGroup').style.display = 'none';
            
            // Show relevant fields based on discharge type
            if (dischargeType === 'completed' || dischargeType === 'static') {
                document.getElementById('dischargeDateGroup').style.display = 'block';
            } else if (dischargeType === 'defaulted') {
                document.getElementById('defaultDateGroup').style.display = 'block';
            } else if (dischargeType === 'cancelled') {
                document.getElementById('cancellationGroup').style.display = 'block';
            }
            // For 'ongoing' type, no additional fields are shown
        }

        // Mock Data functionality
        function fillHandMockData() {
            // Get current date and future date
            var currentDate = new Date().toISOString().split('T')[0];
            var futureDate = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            // Section 1: Reference Information
            document.getElementById('ourRefNumber').value = 'TMH/PHY/2024/001';
            document.getElementById('ourRefSuffix').value = '12345';
            document.getElementById('yourRef').value = 'DOC/REF/2024/456';
            document.getElementById('yourRefDate').value = currentDate;
            document.getElementById('reportDate').value = currentDate;
            document.getElementById('recipient').value = 'Dr. John Smith';
            
            // Section 2: Patient Information
            document.getElementById('patientName').value = 'Tam, Susan M.Y.';
            document.getElementById('patientSex').value = 'Female';
            document.getElementById('patientAge').value = '42';
            document.getElementById('hkidNo').value = 'D456789(0)';
            document.getElementById('physiotherapyOpdNo').value = 'PHY240004';
            
            // Section 3: Diagnosis
            document.getElementById('diagnosis').value = 'Right hand tendon injury post-repair';
            
            // Section 5: Duration of Treatment
            document.getElementById('totalSessions').value = '12';
            document.getElementById('attendedSessions').value = '10';
            document.getElementById('defaultedSessions').value = '2';
            document.getElementById('registrationDate').value = currentDate;
            document.getElementById('treatmentStartDate').value = currentDate;
            document.getElementById('treatmentEndDate').value = futureDate;
            document.getElementById('caseTherapists').value = 'Ms. Chan Mei Ling';
            document.getElementById('reportWrittenBy').value = 'Mr. Li Wing Hong';
            
            // Section 6: Initial Clinical Findings
            document.getElementById('initialDate').value = currentDate;
            document.getElementById('initialSide').value = 'Right';
            document.getElementById('initialLocation').value = 'hand';
            document.getElementById('initialPainIntensity').value = '5';
            document.getElementById('initialOtherSymptoms').value = 'stiffness, weakness';
            document.getElementById('initialSymptomsIntensity').value = '6';
            document.getElementById('initialActivity1').value = 'reading';
            document.getElementById('initialActivity1Duration').value = '2';
            document.getElementById('initialActivity1Unit').value = 'minutes';
            document.getElementById('initialActivity2').value = 'walking';
            document.getElementById('initialActivity2Duration').value = '1';
            document.getElementById('initialActivity2Unit').value = 'minutes';
            document.getElementById('initialActivity2Aid').value = 'unaided';
            document.getElementById('initialOtherFunctionalActivities').value = 'She has difficulty with daily activities requiring hand function.';
            document.getElementById('initialOverallImprovement').value = '';
            
            // Section 6: Final Clinical Findings
            document.getElementById('finalDate').value = futureDate;
            document.getElementById('finalSide').value = 'Right';
            document.getElementById('finalLocation').value = 'hand';
            document.getElementById('finalPainIntensity').value = '1';
            document.getElementById('finalOtherSymptoms').value = 'mild stiffness';
            document.getElementById('finalSymptomsIntensity').value = '1';
            document.getElementById('finalActivity1').value = 'reading';
            document.getElementById('finalActivity1Duration').value = '15';
            document.getElementById('finalActivity1Unit').value = 'minutes';
            document.getElementById('finalActivity2').value = 'walking';
            document.getElementById('finalActivity2Duration').value = '3';
            document.getElementById('finalActivity2Unit').value = 'minutes';
            document.getElementById('finalActivity2Aid').value = 'unaided';
            document.getElementById('finalOtherFunctionalActivities').value = 'She can now perform daily activities requiring hand function with improved strength.';
            document.getElementById('finalOverallImprovement').value = '8';
            
            // Section 7: Treatment Methods
            document.getElementById('manualTherapy').checked = true;
            document.getElementById('exerciseTherapy').checked = true;
            document.getElementById('otherTreatment').value = 'Splinting and hand therapy';
            
            // Section 8: Discharge Summary
            document.getElementById('dischargeType').value = 'completed';
            document.getElementById('dischargeDate').value = futureDate;
            updateDischargeFields(); // Update dynamic fields
            
            // Section 9: Declaration
            document.getElementById('consentDate').value = currentDate;
            document.getElementById('therapistName').value = 'Mr. Li Wing Hong';
            document.getElementById('therapistTitle').value = 'Physiotherapist I';
            document.getElementById('educationQualifications').value = 'BSc (Physiotherapy)\nMember of Hong Kong Physiotherapy Association';
            
            // Add referral source
            var referralContainer = document.getElementById('referralSources');
            if (referralContainer.children.length === 0) {
                addReferralSource();
            }
            var firstDeptInput = referralContainer.querySelector('.referral-department');
            var firstHospitalInput = referralContainer.querySelector('.referral-hospital');
            if (firstDeptInput) firstDeptInput.value = 'Department of Orthopedics and Traumatology';
            if (firstHospitalInput) firstHospitalInput.value = 'Tuen Mun Hospital';
            
            // Trigger region field updates for initial and final
            updateInitialRegionFields();
            updateFinalRegionFields();
            
            // Fill objective findings after a short delay to ensure fields are generated
            setTimeout(function() {
                fillHandObjectiveFindings();
            }, 200);
            
            alert('Hand mock data loaded successfully!');
        }
        
        function fillHandObjectiveFindings() {
            // Initial findings - Hand grip strength
            var initialLeftHandGrip = document.getElementById('initialLeftHandGrip');
            var initialRightHandGrip = document.getElementById('initialRightHandGrip');
            var initialLeftPinchGrip = document.getElementById('initialLeftPinchGrip');
            var initialRightPinchGrip = document.getElementById('initialRightPinchGrip');
            var initialLeftLateralPinch = document.getElementById('initialLeftLateralPinch');
            var initialRightLateralPinch = document.getElementById('initialRightLateralPinch');
            
            if (initialLeftHandGrip) initialLeftHandGrip.value = '25';
            if (initialRightHandGrip) initialRightHandGrip.value = 'not tested';
            if (initialLeftPinchGrip) initialLeftPinchGrip.value = '8';
            if (initialRightPinchGrip) initialRightPinchGrip.value = 'not tested';
            if (initialLeftLateralPinch) initialLeftLateralPinch.value = '10';
            if (initialRightLateralPinch) initialRightLateralPinch.value = 'not tested';
            
            // Final findings - Hand grip strength
            var finalLeftHandGrip = document.getElementById('finalLeftHandGrip');
            var finalRightHandGrip = document.getElementById('finalRightHandGrip');
            var finalLeftPinchGrip = document.getElementById('finalLeftPinchGrip');
            var finalRightPinchGrip = document.getElementById('finalRightPinchGrip');
            var finalLeftLateralPinch = document.getElementById('finalLeftLateralPinch');
            var finalRightLateralPinch = document.getElementById('finalRightLateralPinch');
            
            if (finalLeftHandGrip) finalLeftHandGrip.value = '25';
            if (finalRightHandGrip) finalRightHandGrip.value = '20';
            if (finalLeftPinchGrip) finalLeftPinchGrip.value = '8';
            if (finalRightPinchGrip) finalRightPinchGrip.value = '6';
            if (finalLeftLateralPinch) finalLeftLateralPinch.value = '10';
            if (finalRightLateralPinch) finalRightLateralPinch.value = '8';
            
            // Fill AROM data for initial findings
            var initialAromInputs = document.querySelectorAll('#initialAromMovements input');
            if (initialAromInputs.length >= 2) {
                initialAromInputs[0].value = '30'; // Wrist flexion AROM
                initialAromInputs[1].value = '25'; // Wrist extension AROM
                if (initialAromInputs.length >= 4) { // If PROM is included
                    initialAromInputs[2].value = '40'; // Wrist flexion PROM
                    initialAromInputs[3].value = '35'; // Wrist extension PROM
                }
            }
            
            // Fill AROM data for final findings
            var finalAromInputs = document.querySelectorAll('#finalAromMovements input');
            if (finalAromInputs.length >= 2) {
                finalAromInputs[0].value = '70'; // Wrist flexion AROM
                finalAromInputs[1].value = '65'; // Wrist extension AROM
                if (finalAromInputs.length >= 4) { // If PROM is included
                    finalAromInputs[2].value = '80'; // Wrist flexion PROM
                    finalAromInputs[3].value = '75'; // Wrist extension PROM
                }
            }
            
            // Set assessment checkboxes and values
            // Initial findings
            var initialTenderness = document.getElementById('initialTenderness');
            var initialSwelling = document.getElementById('initialSwelling');
            var initialSensation = document.getElementById('initialSensation');
            
            if (initialTenderness) {
                initialTenderness.checked = true;
                toggleInitialTenderness();
                var initialTendernessArea = document.getElementById('initialTendernessArea');
                if (initialTendernessArea) initialTendernessArea.value = 'right hand tendons';
            }
            
            if (initialSwelling) {
                initialSwelling.checked = true;
                toggleInitialSwelling();
                var initialSwellingPresent = document.querySelector('input[name="initialSwellingPresent"][value="yes"]');
                if (initialSwellingPresent) initialSwellingPresent.checked = true;
            }
            
            if (initialSensation) {
                initialSensation.checked = true;
                toggleInitialSensation();
                var initialSensationStatus = document.getElementById('initialSensationStatus');
                if (initialSensationStatus) {
                    initialSensationStatus.value = 'reduced';
                    toggleInitialSensationDetails();
                    var initialSensationReduction = document.getElementById('initialSensationReduction');
                    var initialAreaReduced = document.getElementById('initialAreaReduced');
                    if (initialSensationReduction) initialSensationReduction.value = '30';
                    if (initialAreaReduced) initialAreaReduced.value = 'right index and middle finger';
                }
            }
            
            // Final findings
            var finalTenderness = document.getElementById('finalTenderness');
            var finalSwelling = document.getElementById('finalSwelling');
            var finalSensation = document.getElementById('finalSensation');
            
            if (finalTenderness) {
                finalTenderness.checked = true;
                toggleFinalTenderness();
                var finalTendernessArea = document.getElementById('finalTendernessArea');
                if (finalTendernessArea) finalTendernessArea.value = 'mild tenderness over right hand';
            }
            
            if (finalSwelling) {
                finalSwelling.checked = true;
                toggleFinalSwelling();
                var finalSwellingPresent = document.querySelector('input[name="finalSwellingPresent"][value="no"]');
                if (finalSwellingPresent) finalSwellingPresent.checked = true;
            }
            
            if (finalSensation) {
                finalSensation.checked = true;
                toggleFinalSensation();
                var finalSensationStatus = document.getElementById('finalSensationStatus');
                if (finalSensationStatus) {
                    finalSensationStatus.value = 'intact';
                    toggleFinalSensationDetails();
                }
            }
            
            // Set questionnaire data
            var initialQuestionnaire = document.getElementById('initialQuestionnaire');
            var initialQuestionnaireScore = document.getElementById('initialQuestionnaireScore');
            if (initialQuestionnaire) initialQuestionnaire.value = 'QuickDASH';
            if (initialQuestionnaireScore) initialQuestionnaireScore.value = '75';
            
            var finalQuestionnaire = document.getElementById('finalQuestionnaire');
            var finalQuestionnaireScore = document.getElementById('finalQuestionnaireScore');
            if (finalQuestionnaire) finalQuestionnaire.value = 'QuickDASH';
            if (finalQuestionnaireScore) finalQuestionnaireScore.value = '20';
        }

        // Data export functionality
        function generateDataString() {
            var data = {
                // Section 1: Reference
                ourRefNumber: document.getElementById('ourRefNumber').value,
                ourRefSuffix: document.getElementById('ourRefSuffix').value,
                yourRef: document.getElementById('yourRef').value,
                reportDate: document.getElementById('reportDate').value,
                yourRefDate: document.getElementById('yourRefDate').value,
                recipient: document.getElementById('recipient').value,

                // Section 2: Patient Info
                patientName: document.getElementById('patientName').value,
                patientSex: document.getElementById('patientSex').value,
                patientAge: document.getElementById('patientAge').value,
                hkidNo: document.getElementById('hkidNo').value,
                physiotherapyOpdNo: document.getElementById('physiotherapyOpdNo').value,

                // Section 3: Diagnosis
                diagnosis: document.getElementById('diagnosis').value,

                // Section 5: Duration
                totalSessions: document.getElementById('totalSessions').value,
                registrationDate: document.getElementById('registrationDate').value,
                treatmentStartDate: document.getElementById('treatmentStartDate').value,
                treatmentEndDate: document.getElementById('treatmentEndDate').value,
                caseTherapists: document.getElementById('caseTherapists').value,
                reportWrittenBy: document.getElementById('reportWrittenBy').value,
                attendedSessions: document.getElementById('attendedSessions').value,
                defaultedSessions: document.getElementById('defaultedSessions').value,

                // Section 6: Clinical - Initial
                initialDate: document.getElementById('initialDate').value,
                initialSide: document.getElementById('initialSide').value,
                initialLocation: document.getElementById('initialLocation').value,
                initialPainIntensity: document.getElementById('initialPainIntensity').value,
                initialOtherSymptoms: document.getElementById('initialOtherSymptoms').value,
                initialSymptomsIntensity: document.getElementById('initialSymptomsIntensity').value,
                initialOverallImprovement: document.getElementById('initialOverallImprovement').value,

                // Section 6: Clinical - Final
                finalDate: document.getElementById('finalDate').value,
                finalSide: document.getElementById('finalSide').value,
                finalLocation: document.getElementById('finalLocation').value,
                finalPainIntensity: document.getElementById('finalPainIntensity').value,
                finalOtherSymptoms: document.getElementById('finalOtherSymptoms').value,
                finalSymptomsIntensity: document.getElementById('finalSymptomsIntensity').value,
                finalOverallImprovement: document.getElementById('finalOverallImprovement').value,

                // Section 6: Toes ROM for ankle
                initialToesROM: document.getElementById('initialToesROM') ? document.getElementById('initialToesROM').value : '',

                // Section 6: Fingers/Toes data
                fingersToesData: fingersToesData,

                // Section 7: Treatment
                treatments: {
                    // Thermal Therapy
                    hotPack: document.getElementById('hotPack').checked,
                    coldPack: document.getElementById('coldPack').checked,
                    waxTherapy: document.getElementById('waxTherapy').checked,
                    hydrotherapy: document.getElementById('hydrotherapy').checked,
                    
                    // Traction Therapy
                    intermittentLumbarTraction: document.getElementById('intermittentLumbarTraction').checked,
                    intermittentNeckTraction: document.getElementById('intermittentNeckTraction').checked,
                    
                    // Manual Therapy
                    manualTherapy: document.getElementById('manualTherapy').checked,
                    
                    // Exercise Therapy
                    mobilizationExercise: document.getElementById('mobilizationExercise').checked,
                    strengtheningExercise: document.getElementById('strengtheningExercise').checked,
                    exerciseTherapy: document.getElementById('exerciseTherapy').checked,
                    
                    // Functional Training
                    balanceTraining: document.getElementById('balanceTraining').checked,
                    gaitTraining: document.getElementById('gaitTraining').checked,
                    functionalTraining: document.getElementById('functionalTraining').checked,
                    
                    // Electrical Therapy
                    interferential: document.getElementById('interferential').checked,
                    nmes: document.getElementById('nmes').checked,
                    tens: document.getElementById('tens').checked,
                    ultrasound: document.getElementById('ultrasound').checked,
                    pulsedElectromagnetic: document.getElementById('pulsedElectromagnetic').checked,
                    shockwave: document.getElementById('shockwave').checked,
                    microCurrent: document.getElementById('microCurrent').checked,
                    infraredLight: document.getElementById('infraredLight').checked,
                    polarizedPolychromatic: document.getElementById('polarizedPolychromatic').checked,
                    highElectromagnetic: document.getElementById('highElectromagnetic').checked,
                    pulsedShortwave: document.getElementById('pulsedShortwave').checked,
                    flowpulse: document.getElementById('flowpulse').checked,
                    laser: document.getElementById('laser').checked,
                    
                    // Others
                    desensitization: document.getElementById('desensitization').checked,
                    acupuncture: document.getElementById('acupuncture').checked
                },
                otherTreatment: document.getElementById('otherTreatment').value,

                // Section 8: Discharge
                dischargeType: document.getElementById('dischargeType').value,
                dischargeDate: document.getElementById('dischargeDate').value,
                defaultDate: document.getElementById('defaultDate').value,
                cancellationDate: document.getElementById('cancellationDate').value,
                scheduledAppointmentDate: document.getElementById('scheduledAppointmentDate').value,
                cancellationReason: document.getElementById('cancellationReason').value,

                // Section 9: Declaration
                consentDate: document.getElementById('consentDate').value,
                therapistName: document.getElementById('therapistName').value,
                therapistTitle: document.getElementById('therapistTitle').value,
                educationQualifications: document.getElementById('educationQualifications').value,

                // Referral sources
                referralSources: getReferralSourcesData()
            };

            var jsonString = JSON.stringify(data, null, 2);
            var base64String = btoa(jsonString);
            
            document.getElementById('exportOutput').textContent = base64String;
        }

        function getReferralSourcesData() {
            var sources = [];
            var referralElements = document.getElementsByClassName('referral-source');
            
            for (var i = 0; i < referralElements.length; i++) {
                var dept = referralElements[i].querySelector('.referral-department').value;
                var hospital = referralElements[i].querySelector('.referral-hospital').value;
                
                if (dept || hospital) {
                    sources.push({
                        department: dept,
                        hospital: hospital
                    });
                }
            }
            
            return sources;
        }

        function copyDataString() {
            var output = document.getElementById('exportOutput');
            var textArea = document.createElement('textarea');
            textArea.value = output.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Data string copied to clipboard!');
        }

        // Initialize on page load - ES3/ES4 compatible
        function initializePage() {
            // Set default date to today
            var today = new Date();
            var year = today.getFullYear();
            var month = (today.getMonth() + 1).toString();
            var day = today.getDate().toString();
            
            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;
            
            var dateString = year + '-' + month + '-' + day;
            document.getElementById('reportDate').value = dateString;

            // Initialize with one finger/toe entry for hand/foot regions
            // This will be shown/hidden based on region selection
        }

        // Cross-browser compatible page load event
        if (window.addEventListener) {
            window.addEventListener('load', initializePage, false);
        } else if (window.attachEvent) {
            window.attachEvent('onload', initializePage);
        } else {
            window.onload = initializePage;
        }
    </script>
</body>
</html>