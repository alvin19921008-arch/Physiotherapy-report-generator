<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physiotherapy Report Generator - Lite App v5.0 Clean</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-success {
            background-color: #10b981;
            color: white;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background-color: #e5e7eb;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
        }

        .nav-tab.active {
            background-color: #3b82f6;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background-color: #d1d5db;
        }

        .section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .clinical-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .clinical-tab {
            padding: 10px 20px;
            background-color: #f3f4f6;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .clinical-tab.active {
            background-color: #3b82f6;
            color: white;
        }

        .clinical-content {
            display: none;
        }

        .clinical-content.active {
            display: block;
        }

        .export-section {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .export-output {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Physiotherapy Report Generator - Lite App v5.0 Clean</h1>
            <div class="subtitle">Syntax Error Free | Full Data Compatibility | Corporate Ready</div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button type="button" class="btn btn-primary" data-action="test">Test JavaScript</button>
            <button type="button" class="btn btn-success" data-action="generate">Generate Data String</button>
            <button type="button" class="btn btn-secondary" data-action="fill-mock">Fill Mock Data</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="1">Section 1: Reference</button>
            <button class="nav-tab" data-section="2">Section 2: Patient Info</button>
            <button class="nav-tab" data-section="3">Section 3: Diagnosis</button>
            <button class="nav-tab" data-section="4">Section 4: Referral</button>
            <button class="nav-tab" data-section="5">Section 5: Duration</button>
            <button class="nav-tab" data-section="6">Section 6: Clinical</button>
            <button class="nav-tab" data-section="7">Section 7: Treatment</button>
            <button class="nav-tab" data-section="8">Section 8: Discharge</button>
            <button class="nav-tab" data-section="9">Section 9: Declaration</button>
        </div>

        <!-- Section 1: Reference Information -->
        <div class="section active" id="section1">
            <h2>Section 1: Reference Information</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Our Reference</label>
                    <input type="text" class="form-control" data-field="ourRef" placeholder="Enter reference number">
                </div>
                <div class="form-group">
                    <label>Our Reference 2</label>
                    <input type="text" class="form-control" data-field="ourRef2" placeholder="Enter reference 2">
                </div>
                <div class="form-group">
                    <label>Your Reference</label>
                    <input type="text" class="form-control" data-field="yourRef" placeholder="Your reference">
                </div>
                <div class="form-group">
                    <label>Your Reference Date</label>
                    <input type="date" class="form-control" data-field="yourRefDate">
                </div>
                <div class="form-group">
                    <label>Report Date</label>
                    <input type="date" class="form-control" data-field="reportDate">
                </div>
                <div class="form-group">
                    <label>Recipient</label>
                    <input type="text" class="form-control" data-field="recipient" placeholder="Report recipient">
                </div>
            </div>
        </div>

        <!-- Section 2: Patient Information -->
        <div class="section" id="section2">
            <h2>Section 2: Patient Information</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Patient Name</label>
                    <input type="text" class="form-control" data-field="patientName" placeholder="Full name">
                </div>
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" class="form-control" data-field="dateOfBirth">
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select class="form-control" data-field="gender">
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Contact Number</label>
                    <input type="tel" class="form-control" data-field="contactNumber" placeholder="Phone number">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea class="form-control" data-field="address" placeholder="Full address"></textarea>
                </div>
                <div class="form-group">
                    <label>Occupation</label>
                    <input type="text" class="form-control" data-field="occupation" placeholder="Patient's occupation">
                </div>
            </div>
        </div>

        <!-- Section 3: Diagnosis -->
        <div class="section" id="section3">
            <h2>Section 3: Diagnosis</h2>
            <div class="form-group">
                <label>Primary Diagnosis</label>
                <textarea class="form-control" data-field="primaryDiagnosis" placeholder="Enter primary diagnosis"></textarea>
            </div>
            <div class="form-group">
                <label>Secondary Diagnosis</label>
                <textarea class="form-control" data-field="secondaryDiagnosis" placeholder="Enter secondary diagnosis (if any)"></textarea>
            </div>
            <div class="form-group">
                <label>Medical History</label>
                <textarea class="form-control" data-field="medicalHistory" placeholder="Relevant medical history"></textarea>
            </div>
        </div>

        <!-- Section 4: Referral Source -->
        <div class="section" id="section4">
            <h2>Section 4: Referral Source</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Referring Doctor</label>
                    <input type="text" class="form-control" data-field="referringDoctor" placeholder="Doctor's name">
                </div>
                <div class="form-group">
                    <label>Referral Date</label>
                    <input type="date" class="form-control" data-field="referralDate">
                </div>
                <div class="form-group">
                    <label>Hospital/Clinic</label>
                    <input type="text" class="form-control" data-field="hospitalClinic" placeholder="Institution name">
                </div>
                <div class="form-group">
                    <label>Referral Reason</label>
                    <textarea class="form-control" data-field="referralReason" placeholder="Reason for referral"></textarea>
                </div>
            </div>
        </div>

        <!-- Section 5: Treatment Duration -->
        <div class="section" id="section5">
            <h2>Section 5: Treatment Duration</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" class="form-control" data-field="startDate">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" class="form-control" data-field="endDate">
                </div>
                <div class="form-group">
                    <label>Total Sessions</label>
                    <input type="number" class="form-control" data-field="totalSessions" placeholder="Number of sessions">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select class="form-control" data-field="frequency">
                        <option value="">Select frequency</option>
                        <option value="Daily">Daily</option>
                        <option value="2x per week">2x per week</option>
                        <option value="3x per week">3x per week</option>
                        <option value="Weekly">Weekly</option>
                        <option value="Bi-weekly">Bi-weekly</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Section 6: Clinical Findings -->
        <div class="section" id="section6">
            <h2>Section 6: Clinical Findings</h2>
            
            <!-- Clinical Tabs -->
            <div class="clinical-tabs">
                <button class="clinical-tab active" data-clinical="initial">Initial Findings</button>
                <button class="clinical-tab" data-clinical="interim">Interim Findings</button>
                <button class="clinical-tab" data-clinical="final">Final Findings</button>
            </div>

            <!-- Initial Clinical Content -->
            <div class="clinical-content active" id="initialClinical">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" data-field="initialFindings.date">
                </div>
                <div class="form-group">
                    <label>Patient Complaints</label>
                    <textarea class="form-control" data-field="initialFindings.complaints.description" placeholder="Patient's main complaints"></textarea>
                </div>
                <div class="form-group">
                    <label>Objective Findings</label>
                    <textarea class="form-control" data-field="initialFindings.objectiveFindings.observation" placeholder="Clinical observations"></textarea>
                </div>
                <div class="form-group">
                    <label>Assessment</label>
                    <textarea class="form-control" data-field="initialFindings.assessment" placeholder="Clinical assessment"></textarea>
                </div>
                <div class="form-group">
                    <label>Plan</label>
                    <textarea class="form-control" data-field="initialFindings.plan" placeholder="Treatment plan"></textarea>
                </div>
            </div>

            <!-- Interim Clinical Content -->
            <div class="clinical-content" id="interimClinical">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" data-field="interimFindings.date">
                </div>
                <div class="form-group">
                    <label>Patient Complaints</label>
                    <textarea class="form-control" data-field="interimFindings.complaints.description" placeholder="Updated complaints"></textarea>
                </div>
                <div class="form-group">
                    <label>Objective Findings</label>
                    <textarea class="form-control" data-field="interimFindings.objectiveFindings.observation" placeholder="Updated observations"></textarea>
                </div>
                <div class="form-group">
                    <label>Assessment</label>
                    <textarea class="form-control" data-field="interimFindings.assessment" placeholder="Updated assessment"></textarea>
                </div>
                <div class="form-group">
                    <label>Plan</label>
                    <textarea class="form-control" data-field="interimFindings.plan" placeholder="Updated plan"></textarea>
                </div>
            </div>

            <!-- Final Clinical Content -->
            <div class="clinical-content" id="finalClinical">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" data-field="finalFindings.date">
                </div>
                <div class="form-group">
                    <label>Patient Complaints</label>
                    <textarea class="form-control" data-field="finalFindings.complaints.description" placeholder="Final complaints"></textarea>
                </div>
                <div class="form-group">
                    <label>Objective Findings</label>
                    <textarea class="form-control" data-field="finalFindings.objectiveFindings.observation" placeholder="Final observations"></textarea>
                </div>
                <div class="form-group">
                    <label>Assessment</label>
                    <textarea class="form-control" data-field="finalFindings.assessment" placeholder="Final assessment"></textarea>
                </div>
                <div class="form-group">
                    <label>Plan</label>
                    <textarea class="form-control" data-field="finalFindings.plan" placeholder="Final plan"></textarea>
                </div>
            </div>
        </div>

        <!-- Section 7: Treatment Methods -->
        <div class="section" id="section7">
            <h2>Section 7: Treatment Methods</h2>
            <div class="form-group">
                <label>Treatment Methods Used</label>
                <div id="treatmentMethods">
                    <div class="grid-2" style="margin-bottom: 15px;">
                        <label><input type="checkbox" data-treatment="Manual Therapy"> Manual Therapy</label>
                        <label><input type="checkbox" data-treatment="Exercise Therapy"> Exercise Therapy</label>
                        <label><input type="checkbox" data-treatment="Electrotherapy"> Electrotherapy</label>
                        <label><input type="checkbox" data-treatment="Heat Therapy"> Heat Therapy</label>
                        <label><input type="checkbox" data-treatment="Cold Therapy"> Cold Therapy</label>
                        <label><input type="checkbox" data-treatment="Hydrotherapy"> Hydrotherapy</label>
                        <label><input type="checkbox" data-treatment="Massage"> Massage</label>
                        <label><input type="checkbox" data-treatment="Acupuncture"> Acupuncture</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Treatment Details</label>
                <textarea class="form-control" data-field="treatmentDetails" placeholder="Detailed description of treatments provided"></textarea>
            </div>
        </div>

        <!-- Section 8: Discharge Summary -->
        <div class="section" id="section8">
            <h2>Section 8: Discharge Summary</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Discharge Date</label>
                    <input type="date" class="form-control" data-field="dischargeSummary.componentData.dischargeDate">
                </div>
                <div class="form-group">
                    <label>Discharge Status</label>
                    <select class="form-control" data-field="dischargeSummary.componentData.dischargeStatus">
                        <option value="">Select status</option>
                        <option value="Completed">Treatment Completed</option>
                        <option value="Improved">Improved</option>
                        <option value="Partial">Partial Improvement</option>
                        <option value="No Change">No Change</option>
                        <option value="Referred">Referred to Specialist</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Final Outcome</label>
                    <textarea class="form-control" data-field="dischargeSummary.componentData.finalOutcome" placeholder="Final treatment outcome"></textarea>
                </div>
                <div class="form-group">
                    <label>Recommendations</label>
                    <textarea class="form-control" data-field="dischargeSummary.componentData.recommendations" placeholder="Post-discharge recommendations"></textarea>
                </div>
            </div>
        </div>

        <!-- Section 9: Declaration -->
        <div class="section" id="section9">
            <h2>Section 9: Declaration</h2>
            <div class="form-group">
                <label>Therapist Name</label>
                <input type="text" class="form-control" data-field="therapistName" placeholder="Physiotherapist name">
            </div>
            <div class="form-group">
                <label>Registration Number</label>
                <input type="text" class="form-control" data-field="registrationNumber" placeholder="Professional registration number">
            </div>
            <div class="form-group">
                <label>Signature Date</label>
                <input type="date" class="form-control" data-field="signatureDate">
            </div>
            <div class="form-group">
                <label>Additional Notes</label>
                <textarea class="form-control" data-field="additionalNotes" placeholder="Any additional notes or comments"></textarea>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3>Data Export</h3>
            <p>Generate data string for import into the full application:</p>
            <button type="button" class="btn btn-primary" data-action="copy">Copy Data String</button>
            <textarea class="export-output" id="exportOutput" readonly placeholder="Generated data will appear here..."></textarea>
        </div>
    </div>

    <script>
        // Clean, simple JavaScript with no syntax errors
        
        // Global state object
        var AppState = {
            currentSection: 1,
            currentClinicalTab: 'initial',
            data: {}
        };

        // Initialize the application
        function initApp() {
            console.log('Lite App v5.0 initializing...');
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize data structure
            initializeDataStructure();
            
            // Show initial section
            showSection(1);
            
            console.log('Lite App v5.0 initialized successfully');
        }

        // Set up all event listeners using event delegation
        function setupEventListeners() {
            document.addEventListener('click', function(e) {
                var target = e.target;
                var action = target.getAttribute('data-action');
                var section = target.getAttribute('data-section');
                var clinical = target.getAttribute('data-clinical');
                
                // Handle action buttons
                if (action === 'test') {
                    testFunction();
                } else if (action === 'generate') {
                    generateDataString();
                } else if (action === 'copy') {
                    copyDataString();
                } else if (action === 'fill-mock') {
                    fillMockData();
                }
                
                // Handle section navigation
                if (section) {
                    showSection(parseInt(section));
                }
                
                // Handle clinical tab navigation
                if (clinical) {
                    showClinicalTab(clinical);
                }
            });

            // Handle form input changes
            document.addEventListener('change', function(e) {
                var target = e.target;
                var field = target.getAttribute('data-field');
                var treatment = target.getAttribute('data-treatment');
                
                if (field) {
                    updateDataField(field, target.value);
                }
                
                if (treatment) {
                    updateTreatmentMethod(treatment, target.checked);
                }
            });

            // Handle text input changes
            document.addEventListener('input', function(e) {
                var target = e.target;
                var field = target.getAttribute('data-field');
                
                if (field) {
                    updateDataField(field, target.value);
                }
            });
        }

        // Initialize the data structure compatible with full app
        function initializeDataStructure() {
            AppState.data = {
                // Section 1: Reference Information
                ourRef: '',
                ourRef2: '',
                yourRef: '',
                yourRefDate: '',
                reportDate: '',
                recipient: '',
                
                // Section 2: Patient Information
                patientName: '',
                dateOfBirth: '',
                gender: '',
                contactNumber: '',
                address: '',
                occupation: '',
                
                // Section 3: Diagnosis
                primaryDiagnosis: '',
                secondaryDiagnosis: '',
                medicalHistory: '',
                
                // Section 4: Referral Source
                referringDoctor: '',
                referralDate: '',
                hospitalClinic: '',
                referralReason: '',
                
                // Section 5: Treatment Duration
                startDate: '',
                endDate: '',
                totalSessions: '',
                frequency: '',
                
                // Section 6: Clinical Findings (nested structure)
                initialFindings: {
                    date: '',
                    complaints: {
                        description: ''
                    },
                    objectiveFindings: {
                        observation: ''
                    },
                    assessment: '',
                    plan: ''
                },
                interimFindings: {
                    date: '',
                    complaints: {
                        description: ''
                    },
                    objectiveFindings: {
                        observation: ''
                    },
                    assessment: '',
                    plan: ''
                },
                finalFindings: {
                    date: '',
                    complaints: {
                        description: ''
                    },
                    objectiveFindings: {
                        observation: ''
                    },
                    assessment: '',
                    plan: ''
                },
                
                // Section 7: Treatment Methods
                treatments: [],
                treatmentDetails: '',
                
                // Section 8: Discharge Summary (nested structure)
                dischargeSummary: {
                    componentData: {
                        dischargeDate: '',
                        dischargeStatus: '',
                        finalOutcome: '',
                        recommendations: ''
                    }
                },
                
                // Section 9: Declaration
                therapistName: '',
                registrationNumber: '',
                signatureDate: '',
                additionalNotes: ''
            };
        }

        // Update data field with nested path support
        function updateDataField(fieldPath, value) {
            var keys = fieldPath.split('.');
            var obj = AppState.data;
            
            // Navigate to the nested object
            for (var i = 0; i < keys.length - 1; i++) {
                if (!obj[keys[i]]) {
                    obj[keys[i]] = {};
                }
                obj = obj[keys[i]];
            }
            
            // Set the final value
            obj[keys[keys.length - 1]] = value;
        }

        // Update treatment methods
        function updateTreatmentMethod(treatment, checked) {
            var treatments = AppState.data.treatments;
            var existingIndex = -1;
            
            // Find existing treatment
            for (var i = 0; i < treatments.length; i++) {
                if (treatments[i].method === treatment) {
                    existingIndex = i;
                    break;
                }
            }
            
            if (checked && existingIndex === -1) {
                // Add treatment
                treatments.push({
                    method: treatment,
                    area: '' // Empty area for compatibility
                });
            } else if (!checked && existingIndex !== -1) {
                // Remove treatment
                treatments.splice(existingIndex, 1);
            }
        }

        // Show section function
        function showSection(sectionNumber) {
            try {
                // Hide all sections
                var sections = document.querySelectorAll('.section');
                for (var i = 0; i < sections.length; i++) {
                    sections[i].classList.remove('active');
                }
                
                // Remove active class from all tabs
                var tabs = document.querySelectorAll('.nav-tab');
                for (var i = 0; i < tabs.length; i++) {
                    tabs[i].classList.remove('active');
                }
                
                // Show target section
                var targetSection = document.getElementById('section' + sectionNumber);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Activate corresponding tab
                var targetTab = document.querySelector('[data-section="' + sectionNumber + '"]');
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Update state
                AppState.currentSection = sectionNumber;
                
                // Scroll to top
                window.scrollTo(0, 0);
                
            } catch (error) {
                console.error('Navigation error:', error);
            }
        }

        // Show clinical tab function
        function showClinicalTab(tabName) {
            try {
                // Hide all clinical content
                var contents = document.querySelectorAll('.clinical-content');
                for (var i = 0; i < contents.length; i++) {
                    contents[i].classList.remove('active');
                }
                
                // Remove active class from all clinical tabs
                var tabs = document.querySelectorAll('.clinical-tab');
                for (var i = 0; i < tabs.length; i++) {
                    tabs[i].classList.remove('active');
                }
                
                // Show target content
                var targetContent = document.getElementById(tabName + 'Clinical');
                if (targetContent) {
                    targetContent.classList.add('active');
                }
                
                // Activate corresponding tab
                var targetTab = document.querySelector('[data-clinical="' + tabName + '"]');
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Update state
                AppState.currentClinicalTab = tabName;
                
            } catch (error) {
                console.error('Clinical tab error:', error);
            }
        }

        // Test function
        function testFunction() {
            alert('JavaScript is working perfectly! All functions are properly defined.');
        }

        // Generate data string for export
        function generateDataString() {
            try {
                var dataString = JSON.stringify(AppState.data, null, 2);
                document.getElementById('exportOutput').value = dataString;
                alert('Data string generated successfully! You can now copy it and import into the full app.');
            } catch (error) {
                alert('Error generating data string: ' + error.message);
            }
        }

        // Copy data string to clipboard
        function copyDataString() {
            try {
                var output = document.getElementById('exportOutput');
                if (!output.value) {
                    generateDataString();
                }
                
                output.select();
                document.execCommand('copy');
                alert('Data string copied to clipboard! You can now paste it into the full app.');
            } catch (error) {
                alert('Error copying data string: ' + error.message);
            }
        }

        // Fill mock data for testing
        function fillMockData() {
            // Sample data for testing
            AppState.data = {
                ourRef: 'REF001',
                ourRef2: 'SUB001',
                yourRef: 'YOUR123',
                yourRefDate: '2025-01-01',
                reportDate: '2025-01-15',
                recipient: 'Dr. Smith',
                
                patientName: 'John Doe',
                dateOfBirth: '1980-05-15',
                gender: 'Male',
                contactNumber: '123-456-7890',
                address: '123 Main Street, City',
                occupation: 'Office Worker',
                
                primaryDiagnosis: 'Lower back pain',
                secondaryDiagnosis: 'Muscle tension',
                medicalHistory: 'No significant medical history',
                
                referringDoctor: 'Dr. Johnson',
                referralDate: '2024-12-01',
                hospitalClinic: 'City General Hospital',
                referralReason: 'Chronic lower back pain',
                
                startDate: '2024-12-15',
                endDate: '2025-01-15',
                totalSessions: '8',
                frequency: '2x per week',
                
                initialFindings: {
                    date: '2024-12-15',
                    complaints: {
                        description: 'Patient reports lower back pain for 3 months'
                    },
                    objectiveFindings: {
                        observation: 'Reduced lumbar flexion, muscle spasm present'
                    },
                    assessment: 'Mechanical lower back pain',
                    plan: 'Manual therapy and exercise program'
                },
                interimFindings: {
                    date: '2025-01-01',
                    complaints: {
                        description: 'Pain reduced from 8/10 to 5/10'
                    },
                    objectiveFindings: {
                        observation: 'Improved range of motion, less muscle spasm'
                    },
                    assessment: 'Good progress with treatment',
                    plan: 'Continue current treatment plan'
                },
                finalFindings: {
                    date: '2025-01-15',
                    complaints: {
                        description: 'Minimal pain, 2/10 intensity'
                    },
                    objectiveFindings: {
                        observation: 'Normal range of motion restored'
                    },
                    assessment: 'Significant improvement achieved',
                    plan: 'Home exercise program for maintenance'
                },
                
                treatments: [
                    { method: 'Manual Therapy', area: '' },
                    { method: 'Exercise Therapy', area: '' },
                    { method: 'Heat Therapy', area: '' }
                ],
                treatmentDetails: 'Manual therapy including spinal mobilization, therapeutic exercises for core strengthening, heat therapy for muscle relaxation',
                
                dischargeSummary: {
                    componentData: {
                        dischargeDate: '2025-01-15',
                        dischargeStatus: 'Improved',
                        finalOutcome: 'Patient achieved significant pain reduction and functional improvement',
                        recommendations: 'Continue home exercise program, return to normal activities gradually'
                    }
                },
                
                therapistName: 'Jane Smith, PT',
                registrationNumber: 'PT12345',
                signatureDate: '2025-01-15',
                additionalNotes: 'Patient was compliant with treatment and showed excellent progress'
            };
            
            // Update form fields with mock data
            updateFormFields();
            alert('Mock data filled successfully! You can now test the export functionality.');
        }

        // Update form fields from data
        function updateFormFields() {
            // Update simple fields
            var inputs = document.querySelectorAll('[data-field]');
            for (var i = 0; i < inputs.length; i++) {
                var input = inputs[i];
                var fieldPath = input.getAttribute('data-field');
                var value = getNestedValue(AppState.data, fieldPath);
                
                if (input.type === 'checkbox') {
                    input.checked = !!value;
                } else {
                    input.value = value || '';
                }
            }
            
            // Update treatment checkboxes
            var treatmentInputs = document.querySelectorAll('[data-treatment]');
            for (var i = 0; i < treatmentInputs.length; i++) {
                var input = treatmentInputs[i];
                var treatment = input.getAttribute('data-treatment');
                var isChecked = false;
                
                for (var j = 0; j < AppState.data.treatments.length; j++) {
                    if (AppState.data.treatments[j].method === treatment) {
                        isChecked = true;
                        break;
                    }
                }
                
                input.checked = isChecked;
            }
        }

        // Get nested value from object using dot notation
        function getNestedValue(obj, path) {
            var keys = path.split('.');
            var current = obj;
            
            for (var i = 0; i < keys.length; i++) {
                if (current && current.hasOwnProperty(keys[i])) {
                    current = current[keys[i]];
                } else {
                    return '';
                }
            }
            
            return current;
        }

        // Initialize the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>